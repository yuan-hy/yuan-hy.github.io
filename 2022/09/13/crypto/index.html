<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="crypto, 袁胡悦">
    <meta name="description" content="他山之石，可以攻玉
在程序中需要加密或者解密数据，需要用到第三方API,仅仅使用 JDK 自带的加解密工具受出口限制，密钥长度不能满足，部分算法未能支持，例如 MD4、SHA-224等
资料参考：Java加密与解密的艺术

1、JCE
jd">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>crypto | 袁胡悦</title>
    <link rel="icon" type="image/png" href="/source/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="袁胡悦" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <span class="logo-span">袁胡悦</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>链接大佬</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <div class="logo-name">袁胡悦</div>
        <div class="logo-desc">
            
            吾生也有涯，而知也无涯
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			链接大佬
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/yuan-hy/yuan-hy.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/yuan-hy/yuan-hy.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/15.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">crypto</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/crypto/">
                                <span class="chip bg-color">crypto</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/crypto/" class="post-category">
                                crypto
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-09-13
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    22.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    101 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="他山之石，可以攻玉"><a href="#他山之石，可以攻玉" class="headerlink" title="他山之石，可以攻玉"></a>他山之石，可以攻玉</h2><blockquote>
<p>在程序中需要加密或者解密数据，需要用到第三方API,仅仅使用 JDK 自带的加解密工具受出口限制，<code>密钥长度不能满足，部分算法未能支持，例如 MD4、SHA-224等</code></p>
<p>资料参考：<code>Java加密与解密的艺术</code></p>
</blockquote>
<h3 id="1、JCE"><a href="#1、JCE" class="headerlink" title="1、JCE"></a>1、JCE</h3><ul>
<li><p>jdk 自带加解密API,安全强度不高，主要原因：密钥长度不够</p>
</li>
<li><p>对以上问题，Sun 官方提供了无政策限制权限文件（Unlimited Strength Jurisdiction Policy Files）,只需要将其部署在 JRE 环境中就可以使用</p>
<ul>
<li><p>首先获取权限文件</p>
<ul>
<li><h6 id="在官网下载-jce-policy-version-zip-，version-表示-jdk版本号"><a href="#在官网下载-jce-policy-version-zip-，version-表示-jdk版本号" class="headerlink" title="在官网下载 jce_policy-version.zip ，version 表示 jdk版本号"></a>在官网下载 jce_policy-version.zip ，version 表示 jdk版本号</h6></li>
<li><h6 id="里面有-local-policy-jar-和-US-export-policy-jar-文件，用于放到-JRE-环境"><a href="#里面有-local-policy-jar-和-US-export-policy-jar-文件，用于放到-JRE-环境" class="headerlink" title="里面有 local_policy.jar 和 US_export_policy.jar 文件，用于放到 JRE 环境"></a>里面有 local_policy.jar 和 US_export_policy.jar 文件，用于放到 JRE 环境</h6></li>
<li><h6 id="将以上连个-jar-文件-放到-JDK-HOME-jre-lib-security-目录下，有可能有必要也放到-JRE-HOME-lib-security目录下覆盖"><a href="#将以上连个-jar-文件-放到-JDK-HOME-jre-lib-security-目录下，有可能有必要也放到-JRE-HOME-lib-security目录下覆盖" class="headerlink" title="将以上连个 jar 文件 放到 %JDK_HOME%\jre\lib\security 目录下，有可能有必要也放到 %JRE_HOME%\lib\security目录下覆盖"></a>将以上连个 jar 文件 放到 %JDK_HOME%\jre\lib\security 目录下，有可能有必要也放到 %JRE_HOME%\lib\security目录下覆盖</h6></li>
<li><p>注意，有时候应用服务器只安装 jre,有必要放在 %JRE_HOME%\lib\security目录下</p>
</li>
<li><p>验证：</p>
<ul>
<li>如何去验证呢？</li>
</ul>
<pre class=" language-java"><code class="language-java">修改这个权限文件的目的是为了获得更长的密钥，对于同一个加密算法，权限配置前后的所支持的密钥长度是不一样的。如果支持更长的密钥长度，说明配置生效
        
</code></pre>
<ul>
<li><p>以 AES 算法为例，（对称加密算法之一，几乎安全级别最高）</p>
<p>Java 6 支持 AES 算法的密钥长度为 128、192、256位，如果不加权限文件，使用会报错 ：</p>
<pre class=" language-java"><code class="language-java">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>InvalidKeyException
</code></pre>
<p>反之会获得正常 256 位的 AES 密钥</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//Key_Algorithm 生成密钥的算法，例如 AES</span>
KeyGenerator kg <span class="token operator">=</span> KeyGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>Key_Algorithm<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true">// AES 支持 128 位、192位、256 位,初始化生成的密钥长度</span>
kg<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SecretKey secretKey <span class="token operator">=</span> kg<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key <span class="token operator">=</span> secretKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="2、BouncyCastle"><a href="#2、BouncyCastle" class="headerlink" title="2、BouncyCastle"></a>2、BouncyCastle</h3></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>但是呢，许多高强度的算法在 JDk 中是没有的，所以需要借助 BC 库，也就是 BouncyCastle，可以在沿用 JDK 下使用 BC 库</p>
<ul>
<li><p>获取 BC 库的 jar 文件(Maven 依赖）</p>
<ul>
<li><p>在 Bouncy Castle 官网下载 bcprov-jdk16-146.jar 和 bcprov-ext-jdk16-146.jar,也可以下载 包含源码和 API 文档 的 bcprov-jdk16-146.zip</p>
</li>
<li><p>如何扩展使用</p>
<ul>
<li><p>配置方式（不推荐）</p>
<ul>
<li><p>通过配置在 JRE 环境，代码中不会显示 Bouncy Castle  Provider</p>
</li>
<li><p>分别在 %JDK_HOME%\jre\lib\security\ 和 %JRE_HOME%\lib\security\ 目录下找到 java.security 文件，添加如下：<code>security.provider.11=org.bouncycastle.jce.provider.BouncycastleProvider</code></p>
<p>配置方式，按顺序，</p>
<p><code>security.provider.n=provider完整 类名</code></p>
<pre class=" language-shell"><code class="language-shell">#
# List of providers and their preference orders (see above):
#
security.provider.1=sun.security.provider.Sun
security.provider.2=sun.security.rsa.SunRsaSign
security.provider.3=sun.security.ec.SunEC
security.provider.4=com.sun.net.ssl.internal.ssl.Provider
security.provider.5=com.sun.crypto.provider.SunJCE
security.provider.6=sun.security.jgss.SunProvider
security.provider.7=com.sun.security.sasl.Provider
security.provider.8=org.jcp.xml.dsig.internal.dom.XMLDSigRI
security.provider.9=sun.security.smartcardio.SunPCSC
security.provider.10=sun.security.mscapi.SunMSCAPI
security.provider.11=org.bouncycastle.jce.provider.BouncycastleProvider
</code></pre>
</li>
<li><p>分别在 %JDK_HOME%\jre\lib\ext\ 和 %JRE_HOME%\lib\ext\ 目录下看到 sunjce_provider.jar，这是支持 jce 的，所以，把 bcprov-ext-jdk16-146.jar 放在该目录下就完成了支持 BC 库</p>
</li>
<li><p>调用方式 (推荐)</p>
<ul>
<li><p>依赖于 Security 类的 addProvider()方法，显示加载 BC  Provider</p>
</li>
<li><p>将 bcprov-jdk16-146.jar 引入工程</p>
<ul>
<li><p>如果是 maven 管理</p>
<pre class=" language-java"><code class="language-java">  <span class="token operator">&lt;</span>dependency<span class="token operator">></span>
   <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>bouncycastle<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
   <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>bcprov<span class="token operator">-</span>jdk16<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
   <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">1.46</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
</code></pre>
</li>
</ul>
</li>
<li><p>如何显示调用 BC Provider</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//初始化 密钥工厂（KeyFactory）、密钥生成器（KeyGenerator）之前调用以下一行代码</span>
Security<span class="token punctuation">.</span><span class="token function">addProvider</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//也可以在初始化 密钥工厂（KeyFactory）、密钥生成器（KeyGenerator）等引擎类的同时使用 "BC" ，完成构建</span>
MessageDigest md <span class="token operator">=</span> MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD4"</span><span class="token punctuation">,</span><span class="token string">"BC"</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//BC 库的 Base64 编码解码 例子</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">base64</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        String data <span class="token operator">=</span> <span class="token string">"中国更强"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原文 : [ "</span><span class="token operator">+</span>data<span class="token operator">+</span><span class="token string">" ]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String output <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"对 [ "</span><span class="token operator">+</span>data<span class="token operator">+</span><span class="token string">" ] 原文 Base64 编码得到 : "</span><span class="token operator">+</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decrypt <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"对 Base64 编码后的 [ "</span><span class="token operator">+</span>output<span class="token operator">+</span><span class="token string">" ] 进行 Base64 解码得到 : "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decrypt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//结果如下：</span>
原文 <span class="token operator">:</span> <span class="token punctuation">[</span> 中国更强 <span class="token punctuation">]</span>
对 <span class="token punctuation">[</span> 中国更强 <span class="token punctuation">]</span> 原文 Base64 编码得到 <span class="token operator">:</span> 5Lit5Zu95pu05by6
对 Base64 编码后的 <span class="token punctuation">[</span> 5Lit5Zu95pu05by6 <span class="token punctuation">]</span> 进行 Base64 解码得到 <span class="token operator">:</span> 中国更强
</code></pre>
<ul>
<li>UrlBase64: Base64 的变体，将字符映射表中用做补位的 “=”,换成 “.”,并用 “-“ 和 “_” 分别代替 “+”,”/“,使得 Base64 编码符合 Url 参数规则</li>
</ul>
<pre class=" language-java"><code class="language-java">        
<span class="token comment" spellcheck="true">//BC 库的 UrlBase64 编码解码 例子</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">urlBase64</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        String url <span class="token operator">=</span> <span class="token string">"Base64 编码"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原文 : [ "</span><span class="token operator">+</span>url<span class="token operator">+</span><span class="token string">" ]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> output <span class="token operator">=</span> UrlBase64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"对 [ "</span><span class="token operator">+</span>url<span class="token operator">+</span><span class="token string">" ] 原文 UrlBase64 编码得到 : "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decrypt <span class="token operator">=</span> UrlBase64<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"对 UrlBase64 编码后的 [ "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" ] 进行 UrlBase64 解码得到 : "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decrypt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//结果如下：</span>
原文 <span class="token operator">:</span> <span class="token punctuation">[</span> Base64 编码 <span class="token punctuation">]</span>
对 <span class="token punctuation">[</span> Base64 编码 <span class="token punctuation">]</span> 原文 UrlBase64 编码得到 <span class="token operator">:</span> QmFzZTY0IOe8lueggQ<span class="token punctuation">.</span><span class="token punctuation">.</span>
对 UrlBase64 编码后的 <span class="token punctuation">[</span> QmFzZTY0IOe8lueggQ<span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span> 进行 UrlBase64 解码得到 <span class="token operator">:</span> Base64 编码
</code></pre>
<ul>
<li>Hex 编码解码</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        String hexData <span class="token operator">=</span> <span class="token string">"Hex 编码"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原文 : [ "</span><span class="token operator">+</span>hexData<span class="token operator">+</span><span class="token string">" ]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input <span class="token operator">=</span> hexData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> Hex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"对 [ "</span><span class="token operator">+</span>hexData<span class="token operator">+</span><span class="token string">" ] 原文 Hex 编码得到 : "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decrypt <span class="token operator">=</span> Hex<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"对 Hex 编码后的 [ "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" ] 进行 Hex 解码得到 : "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decrypt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
 <span class="token comment" spellcheck="true">//结果如下：</span>
原文 <span class="token operator">:</span> <span class="token punctuation">[</span> Hex 编码 <span class="token punctuation">]</span>
对 <span class="token punctuation">[</span> Hex 编码 <span class="token punctuation">]</span> 原文 Hex 编码得到 <span class="token operator">:</span> 48657820e7bc96e7a081
对 Hex 编码后的 <span class="token punctuation">[</span> 48657820e7bc96e7a081 <span class="token punctuation">]</span> 进行 Hex 解码得到 <span class="token operator">:</span> Hex 编码   
</code></pre>
<h3 id="3、Commons-Codec"><a href="#3、Commons-Codec" class="headerlink" title="3、Commons Codec"></a>3、Commons Codec</h3></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>参考具体的资料，类似 bouncycastle 的使用</p>
</li>
<li><p>Base64OutputStream,Base64InputStream 对 Base64 流的支持</p>
</li>
<li><p>标准的rfc2045</p>
<h3 id="4、Base64-编码"><a href="#4、Base64-编码" class="headerlink" title="4、Base64 编码"></a>4、Base64 编码</h3></li>
</ul>
<h4 id="4-1、由来"><a href="#4-1、由来" class="headerlink" title="4.1、由来"></a>4.1、由来</h4><ul>
<li><p>最早用于解决电子邮件传输问题</p>
</li>
<li><p>由于 “历史问题”，电子邮件只允许 ASCII 编码字符，如果要传输一封带有非 ASCII编码字符的电子邮件，当它通过 “历史问题” 的网关时可能就会出现问题，这个网关很可能会对这个非ASCII码字符二进制位做调整，即将这个非ASCII码的8位二进制码的最高位置为 0，此时用户收到的就是一封纯粹的乱码邮件</p>
</li>
</ul>
<h4 id="4-2、定义"><a href="#4-2、定义" class="headerlink" title="4.2、定义"></a>4.2、定义</h4><ul>
<li><p>Base64 是一种基于<code>64</code>个字符的编码算法</p>
</li>
<li><p>经 Base64 编码后的数据长度是原来的<code>4/3</code>倍</p>
</li>
<li><p>经 Base64 编码后的字符串的字符数是以 <code>4</code>为单位的整数倍</p>
</li>
<li><p> Base 64 字符映射表 (A-Z a-z 0-9 + / =)</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>value</th>
<th>encoding</th>
<th>value</th>
<th>encoding</th>
<th>value</th>
<th>encoding</th>
<th>value</th>
<th>encoding</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>A</td>
<td>17</td>
<td>R</td>
<td>34</td>
<td>i</td>
<td>51</td>
<td>z</td>
</tr>
<tr>
<td>1</td>
<td>B</td>
<td>18</td>
<td>S</td>
<td>35</td>
<td>j</td>
<td>52</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>C</td>
<td>19</td>
<td>T</td>
<td>36</td>
<td>k</td>
<td>53</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>D</td>
<td>20</td>
<td>U</td>
<td>37</td>
<td>l</td>
<td>54</td>
<td>2</td>
</tr>
<tr>
<td>4</td>
<td>E</td>
<td>21</td>
<td>V</td>
<td>38</td>
<td>m</td>
<td>55</td>
<td>3</td>
</tr>
<tr>
<td>5</td>
<td>F</td>
<td>22</td>
<td>W</td>
<td>39</td>
<td>n</td>
<td>56</td>
<td>4</td>
</tr>
<tr>
<td>6</td>
<td>G</td>
<td>23</td>
<td>X</td>
<td>40</td>
<td>o</td>
<td>57</td>
<td>5</td>
</tr>
<tr>
<td>7</td>
<td>H</td>
<td>24</td>
<td>Y</td>
<td>41</td>
<td>p</td>
<td>58</td>
<td>6</td>
</tr>
<tr>
<td>8</td>
<td>I</td>
<td>25</td>
<td>Z</td>
<td>42</td>
<td>q</td>
<td>59</td>
<td>7</td>
</tr>
<tr>
<td>9</td>
<td>J</td>
<td>26</td>
<td>a</td>
<td>43</td>
<td>r</td>
<td>60</td>
<td>8</td>
</tr>
<tr>
<td>10</td>
<td>K</td>
<td>27</td>
<td>b</td>
<td>44</td>
<td>s</td>
<td>61</td>
<td>9</td>
</tr>
<tr>
<td>11</td>
<td>L</td>
<td>28</td>
<td>c</td>
<td>45</td>
<td>t</td>
<td>62</td>
<td>+</td>
</tr>
<tr>
<td>12</td>
<td>M</td>
<td>29</td>
<td>d</td>
<td>46</td>
<td>u</td>
<td>63</td>
<td>/</td>
</tr>
<tr>
<td>13</td>
<td>N</td>
<td>30</td>
<td>e</td>
<td>47</td>
<td>v</td>
<td>(pad)</td>
<td>=</td>
</tr>
<tr>
<td>14</td>
<td>O</td>
<td>31</td>
<td>f</td>
<td>48</td>
<td>w</td>
<td></td>
<td></td>
</tr>
<tr>
<td>15</td>
<td>P</td>
<td>32</td>
<td>g</td>
<td>49</td>
<td>x</td>
<td></td>
<td></td>
</tr>
<tr>
<td>16</td>
<td>Q</td>
<td>33</td>
<td>h</td>
<td>50</td>
<td>y</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li><h6 id="解释-：-value-指的是十进制编码-，encoding-指的是-字符-是用来做补位的"><a href="#解释-：-value-指的是十进制编码-，encoding-指的是-字符-是用来做补位的" class="headerlink" title="解释 ： value 指的是十进制编码 ，encoding 指的是 字符 , = 是用来做补位的"></a>解释 ： value 指的是十进制编码 ，encoding 指的是 字符 , = 是用来做补位的</h6></li>
</ul>
<h4 id="4-3、实现原理"><a href="#4-3、实现原理" class="headerlink" title="4.3、实现原理"></a>4.3、实现原理</h4><pre class=" language-shell"><code class="language-shell"># 1、将给定的字符串以字符为单位，转成对应的字符编码（ASCII码 或者UTF-8码）
# 2、将获得的字符编码转换成二进制编码
# 3、将获得的二进制码做分组转换操作，每3个8位二进制码为一组，转成每4个6位二进制码为一组（不足6位时低位补#    0） 这是一个分组变化过程（3*8=4*6=24）
    
# 4、将分组后的每个6位二进制码补位，向6位二进制码高位补2个0变成8位二进制码
# 5、将变成8位二进制的每个分组数据转成十进制码
# 6、将转成的每个十进制码转换成 Base64字符映射表中对应的字符
</code></pre>
<pre class=" language-shell"><code class="language-shell"># 以 ASCII码为例子
1、当只有一个字符串 "A" 时

# 字符                         A
# A 对应的ASCII码              65
# A 对应的二进制码             01000001（不够三个，有多少按多少分组）
#  转成6位二进制码             010000   010000 （上一步不够三个8位二进制码，所以这一步按每6位分一组，                                            只能分成2组）
# 补高位成8位二进制码          00010000  00010000
# 将8位二进制码转十进制码      16         16
# 十进制对应Base64映射表字符   Q          Q

结果等于 QQ？
不是这样的
要根据一个原则：
    1、经 Base64 编码后的字符串的字符数是以 4为单位的整数倍
    这里 QQ 才是2,需要做补位
怎么做补位呢？
    根据余数
    余数 = 原文字节数%3
    余数为 0， 不用 = 号补位，余数为1，补位1个 = 号，余数为2，补位2个 == 号
这里原文字节数 A 为1个字节 1%3=1，要为 4 的倍数，编码后的是 2 个 字符，所以需要补位2个 == 号
所以最终的结果是 ： QQ==
</code></pre>
<pre class=" language-shell"><code class="language-shell"># 补充一个 UTF-8 码字符串为中文的例子
1、以 "密" 为例，它的 UTF-8 编码为 -27 -81 -122

# 字符                         密
# 密 对应的UTF-8 编码            -27         -81          -122
# 密 对应的二进制码            11100101     10101111     10000110  
#  转成6位二进制码             111001  011010  111110 000110
# 补高位成8位二进制码          00111001  00011010 00111110 00000110
# 将8位二进制码转十进制码       57         26        62       6
# 十进制对应Base64映射表字符     5          a        +        G

因为 密的字节数为 3 （ -27 -81 -122 ），所以 3%3=0，不需要补位 "=" 号
所以结果为 5a+G
</code></pre>
<h4 id="4-4、基于-Base64算法数据传递的应用时序图"><a href="#4-4、基于-Base64算法数据传递的应用时序图" class="headerlink" title="4.4、基于 Base64算法数据传递的应用时序图"></a>4.4、基于 Base64算法数据传递的应用时序图</h4><pre class=" language-shell"><code class="language-shell"># -> 表示 实线 --> 表示虚线 ->> 表示实线箭头 -->> 表示虚线箭头
</code></pre>
<pre class=" language-mermaid"><code class="language-mermaid">sequenceDiagram
甲方(发送方) ->> 甲方(发送方) :  1、甲方对数据进行 Base64编码
甲方(发送方) ->> 乙方(接收方) :  2、发送 Base64 编码后的数据
乙方(接收方) ->> 乙方(接收方) :  3、对接收到的 Base64编码数据解码
</code></pre>
<pre class=" language-shell"><code class="language-shell"># 操作流程
# 1、甲方对数据做 Base64 编码处理
# 2、甲方将编码后的数据发送给乙方
# 3、乙方获得数据后对数据做解码处理
</code></pre>
<h3 id="5、消息摘要-验证数据完整性"><a href="#5、消息摘要-验证数据完整性" class="headerlink" title="5、消息摘要-验证数据完整性"></a>5、消息摘要-验证数据完整性</h3><h4 id="5-1、消息摘要算法简述"><a href="#5-1、消息摘要算法简述" class="headerlink" title="5.1、消息摘要算法简述"></a>5.1、消息摘要算法简述</h4><ul>
<li>消息摘要算法包含 <code>MD</code> 、<code>SHA</code>、<code>MAC</code> 共三大系列，常用于验证数据的完整性，是数字签名算法的核心算法</li>
<li>散列函数，验证数据的完整性，任何消息经过散列函数的处理，都会获得唯一的一个散列值，这一过程叫<code>消息摘要</code> ,散列值叫<code>数字指纹</code> ，换句话说，数字指纹唯一，说明数据是一致的，也就是验证原来的数据是不被篡改过的</li>
<li>方便阅读，数字指纹常以十六进制表示</li>
</ul>
<h4 id="5-2、消息摘要算法家族"><a href="#5-2、消息摘要算法家族" class="headerlink" title="5.2、消息摘要算法家族"></a>5.2、消息摘要算法家族</h4><ul>
<li><p>根本</p>
<ul>
<li>核心在于散列函数的单向性，不可通过散列值逆推原始值，这是消息摘要算法安全的根本所在</li>
</ul>
</li>
<li><p>MD 家族</p>
<ul>
<li>MD –&gt; Message Digest 消息摘要，MD2、MD4、MD5共 3 中算法</li>
</ul>
</li>
<li><p>SHA 家族</p>
<ul>
<li>包括 SHA-1(SHA)和SHA-1的变体 SHA-2(SHA-224、SHA-256、SHA-384、SHA-512)</li>
</ul>
</li>
<li><p>MAC 家族</p>
<ul>
<li>综合以上两种算法，HmacMD5、HmacSHA1、Hmac256、HmacSHA384、HmacSHA512</li>
</ul>
</li>
<li><p>RipeMD 等等</p>
</li>
</ul>
<h4 id="5-3、消息摘要算法实现"><a href="#5-3、消息摘要算法实现" class="headerlink" title="5.3、消息摘要算法实现"></a>5.3、消息摘要算法实现</h4><table>
<thead>
<tr>
<th>算法</th>
<th>摘要长度（位）</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>MD2</td>
<td>128</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>MD5</td>
<td>128</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>MD4</td>
<td>128</td>
<td>Bouncy Castle 实现（特别标出来立意是 Java 6不支持）</td>
</tr>
</tbody></table>
<ul>
<li><p>MD5 例子</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// Sun 跟 BouncyCastle 组合</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">MD5Encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        String data <span class="token operator">=</span> <span class="token string">"MD5 计算消息摘要"</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//MD2、MD4一样的用法</span>
            MessageDigest messageDigest <span class="token operator">=</span> MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> messageDigest<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> verify <span class="token operator">=</span> messageDigest<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"数字指纹 : "</span> <span class="token operator">+</span> Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"验证数字指纹 : "</span> <span class="token operator">+</span> Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>verify<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"MD5计算摘要 : "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//结果</span>
数字指纹 <span class="token operator">:</span> c0e8e6ea3635be31265eab56e9392d19
验证数字指纹 <span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre>
</li>
<li><table>
<thead>
<tr>
<th>算法</th>
<th>摘要长度（位）</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>SHA-1</td>
<td>160</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>SHA-256</td>
<td>256</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>SHA-384</td>
<td>384</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>SHA-512</td>
<td>512</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>SHA-224</td>
<td>224</td>
<td>Bouncy Castle 实现（特别标出来立意是 Java 6不支持）</td>
</tr>
</tbody></table>
<ul>
<li>SHA 与 MD 算法不同在于 SHA的摘要长度更长，安全性更高</li>
<li>消息摘要应用时序图</li>
</ul>
</li>
</ul>
<pre class=" language-mermaid"><code class="language-mermaid">sequenceDiagram
甲方(发送方) ->> 乙方(接收方) :  1、甲方公布消息摘要算法
甲方(发送方) ->> 甲方(发送方) :  2、甲方对待发送的消息做摘要处理
甲方(发送方) ->> 乙方(接收方) :  3、甲方向乙方发送摘要处理后的数字指纹
甲方(发送方) ->> 乙方(接收方) :  4、甲方向乙方发送待做摘要处理的消息
乙方(接收方) ->> 乙方(接收方) :  5、乙方获得待做摘要处理的消息后，使用甲方公布的摘要算法对消息做摘要，获得数字指纹后与甲方发送给乙方的数字指纹做对比，一致则验证没被篡改，否则被篡改
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// SHA 算法计算摘要，以 SHA256 为例</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">SHA256Encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        String data <span class="token operator">=</span> <span class="token string">"SHA256 计算消息摘要"</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//SHA-1(简称 SHA)、SHA224、SHA384、SHA512一样的用法</span>
            MessageDigest messageDigest <span class="token operator">=</span> MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"SHA-256"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> messageDigest<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> verify <span class="token operator">=</span> messageDigest<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"数字指纹 : "</span> <span class="token operator">+</span> Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"验证数字指纹 : "</span> <span class="token operator">+</span> Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>verify<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"SHA 256计算摘要 : "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//结果：</span>
数字指纹 <span class="token operator">:</span> 3f2fd32efd99fb6eb8b02c49a44639bea3f36a1af78d0d7a720f33767e35b78c
验证数字指纹 <span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre>
<ul>
<li>MAC 算法<ul>
<li>MAC 算法结合了<code>MD5</code> 和 <code>SHA</code> 的优势，并加入了<code>密钥</code>的支持，是一种更为安全的消息摘要算法</li>
<li>MAC  : <code>Message Authentication Code,消息认证码算法</code> ,是含有密钥散列函数的算法，所以 MAC 也称为 HMAC (keyed-Hash Message Authentication Code )</li>
<li>MAC 集合了 MD 和 SHA 两种系列摘要算法，MD 系列算法：HmacMD2、HmacMD4、HmacMD5，SHA系列算法：HmacSHA1、HmacSHA224、HmacSHA256、HmacSHA384、HmacSHA512</li>
<li>MAC 算法计算的摘要长度跟参与计算的算法摘要长度一样，例如 HmacSHA256 计算的摘要长度是 64 位的十六进制数，与 SHA256 计算的摘要长度是 64 位的十六进制数一样</li>
</ul>
</li>
<li>基于 MAC 算法的消息传递模型</li>
</ul>
<pre class=" language-mermaid"><code class="language-mermaid">sequenceDiagram
甲方(发送方) ->> 乙方(接收方) :  1、甲方公布消息摘要算法
甲方(发送方) ->> 甲方(发送方) :  2、甲方构建密钥
甲方(发送方) ->> 乙方(接收方) :  3、甲方向乙方发送密钥
甲方(发送方) ->> 甲方(发送方) :  4、甲方对待发消息做摘要处理
甲方(发送方) ->> 乙方(接收方) :  5、甲方向乙方发送摘要消息
甲方(发送方) ->> 乙方(接收方) :  6、甲方向乙方发送待发消息
乙方(接收方) ->> 乙方(接收方) :  7、乙方鉴别消息，判断摘要消息与甲方的摘要消息是否一致
</code></pre>
<pre class=" language-shell"><code class="language-shell"># 流程：
# 甲方向乙方公布摘要算法
# 甲乙双方约定按照约定构建密钥，并由一方提供（这里设计甲方提供给乙方）
# 甲方使用密钥对消息做摘要处理，将摘要信息发送给乙方
# 甲方再把消息发给乙方
# 乙方收到消息后，使用密钥对消息做摘要处理，并对比甲方发送的摘要信息是否一致，一致则唯一不被篡改，否则，数据被篡改
</code></pre>
<table>
<thead>
<tr>
<th>算法</th>
<th>摘要长度（位）</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>HmacMD5</td>
<td>128</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>HmacSHA1</td>
<td>160</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>HmacSHA256</td>
<td>256</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>HmacSHA384</td>
<td>384</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>HmacSHA512</td>
<td>512</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>HmacMD2</td>
<td>128</td>
<td>Bouncy Castle 实现（特别标出来立意是 Java 6不支持）</td>
</tr>
<tr>
<td>HmacMD4</td>
<td>128</td>
<td>Bouncy Castle 实现（特别标出来立意是 Java 6不支持）</td>
</tr>
<tr>
<td>HmacSHA224</td>
<td>224</td>
<td>Bouncy Castle 实现（特别标出来立意是 Java 6不支持）</td>
</tr>
</tbody></table>
<ul>
<li><p>MAC 算法是带有密钥的算法，计算摘要需要分为两步：</p>
<ul>
<li><p>构建密钥</p>
</li>
<li><p>使用构建的密钥计算摘要</p>
</li>
</ul>
</li>
<li><p>实现</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//1、构建密钥</span>
<span class="token comment" spellcheck="true">/**
     * 构建 MAC 密钥用于 MAC 摘要计算
     *
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">buildMacKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//通过指定的算法初始化 KeyGenerator</span>
            KeyGenerator keyGenerator <span class="token operator">=</span> KeyGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"HmacMD5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">//产生对称密钥</span>
            SecretKey secretKey <span class="token operator">=</span> keyGenerator<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">//获得密钥</span>
            <span class="token keyword">return</span> secretKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"构建 Mac key 失败"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//2、使用密钥计算摘要</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">MacEncode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//通过构建密钥的算法对密钥进行还原成 SecretKey 对象</span>
        SecretKey secretKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span><span class="token function">buildMacKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"HmacMD5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String data <span class="token operator">=</span> <span class="token string">"MAC 计算摘要"</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//实例化 MAC</span>
            Mac mac <span class="token operator">=</span> Mac<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//初始化 MAC</span>
            mac<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">//执行消息摘要</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> output <span class="token operator">=</span> mac<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> <span class="token operator">|</span> InvalidKeyException e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"MAC 计算摘要失败 : "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//结果：</span>
d362da18bcfac6bbc4894890b0129eff
</code></pre>
</li>
<li><p>循环冗余校验算法-CRC算法</p>
<ul>
<li><p>根据数据产生简短固定位数的一种散列函数，主要用来检测或校验数据传输/保存后出现的错误</p>
</li>
<li><p>生成的散列值在传输或存储之前计算出来并附加在数据后面</p>
</li>
<li><p>32 位二进制数，以 8位16进制数表示</p>
<pre class=" language-bash"><code class="language-bash">文件名称：C:\Users\Administrator\Desktop\K033-K999.zip
文件大小：512050 字节
修改时间：2020年3月16日 09:30:26
MD5     ：E606FA147681797918A2487CB319FF8B
SHA1    ：994D58AD4372F06564F5081FC71DD27ABF60790A
CRC32   ：1B881965
</code></pre>
</li>
<li><p>压缩/解压缩数据传递模型</p>
<pre class=" language-mermaid"><code class="language-mermaid">sequenceDiagram
甲方(发送方) ->> 甲方(发送方) :  1、甲方对数据做冗余校验处理
甲方(发送方) ->> 甲方(发送方) :  2、甲方向数据尾部追加冗余校验码
甲方(发送方) ->> 甲方(发送方) :  3、压缩
甲方(发送方) ->> 乙方(接收方) :  4、甲方向乙方发送数据
乙方(接收方) ->> 乙方(接收方) :  5、解压缩
乙方(接收方) ->> 乙方(接收方) :  6、分离数据和冗余校验码
乙方(接收方) ->> 乙方(接收方) :  7、校验
</code></pre>
</li>
</ul>
</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">crcEncode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        String data <span class="token operator">=</span> <span class="token string">"测试压缩冗余校验码"</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//无参构造创造一个 CRC32 对象</span>
        CRC32 crc32 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CRC32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment" spellcheck="true">//执行 update 完成,会生成一个长整型的冗余校验码</span>
        crc32<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment" spellcheck="true">//转成 Hex</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"8位十六进制冗余校验码 : "</span><span class="token operator">+</span> Long<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>crc32<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//结果：</span>
<span class="token number">8</span>位十六进制冗余校验码 <span class="token operator">:</span> f25bb780
</code></pre>
<ul>
<li>应用文件校验</li>
</ul>
<pre class=" language-java"><code class="language-java">  <span class="token comment" spellcheck="true">//官方 ： apache-maven-3.5.4-bin.zip MD5校验码 ：235db716537989e9e949e5bf23f965c0</span>
  <span class="token comment" spellcheck="true">/**
       * 校验文件下载一致性
       */</span>
      <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fileCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  
          String path <span class="token operator">=</span> <span class="token string">"C:\\Users\\Administrator\\Desktop\\apache-maven-3.5.4-bin.zip"</span><span class="token punctuation">;</span>
          <span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
              FileInputStream fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
              DigestInputStream digestInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DigestInputStream</span><span class="token punctuation">(</span>fileInputStream<span class="token punctuation">,</span>MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">int</span> buf <span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">;</span>
              <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>buf<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token keyword">int</span> read <span class="token operator">=</span>digestInputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">while</span> <span class="token punctuation">(</span>read<span class="token operator">></span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
                  read <span class="token operator">=</span> digestInputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
              digestInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              MessageDigest messageDigest <span class="token operator">=</span> digestInputStream<span class="token punctuation">.</span><span class="token function">getMessageDigest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> messageDigest<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"代码计算文件 MD5 : "</span><span class="token operator">+</span> Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"与官方 MD5 校验 :"</span><span class="token operator">+</span><span class="token string">"235db716537989e9e949e5bf23f965c0"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span><span class="token operator">|</span> IOException e<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
      <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  
  <span class="token comment" spellcheck="true">//结果：</span>
  代码计算文件 MD5 <span class="token operator">:</span> 235db716537989e9e949e5bf23f965c0
  与官方 MD5 校验 <span class="token operator">:</span><span class="token boolean">true</span>
</code></pre>
<h3 id="6、对称加密算法"><a href="#6、对称加密算法" class="headerlink" title="6、对称加密算法"></a>6、对称加密算法</h3><h4 id="6-1、简述"><a href="#6-1、简述" class="headerlink" title="6.1、简述"></a>6.1、简述</h4><ul>
<li>解密算法是加密算法的逆运算</li>
<li>加密算法和解密算法使用同一套密钥</li>
<li>加密方式 ：密码、分组密码</li>
<li>分组密码工作模式 ： ECB、CBC、CFB、CTR等</li>
<li>常用到的算法还有 ： Blowfish、Twofish、Serpent、IDEA、PBE</li>
<li>DES密钥的长度不够，衍生出 DESede 算法（也称为 TripleDES 或3DES算法）,为了替代 DES,衍生出 AES算法</li>
<li>DES 和 DESede 算法在使用密钥材料还原密钥对象时，建议使用各自相应的密钥材料实现类（DES 算法使用 DESKeySpec 类，DESede 对应 DESedeKeySpec 类）</li>
<li>AES 算法在使用密钥材料还原密钥对象时使用一般的密钥材料实现类 SecretKeySpec , 其他算法可参照此用法，类似，RC2、RC4、Blowfish、Twofish、Serpent、IDEA、PBE等</li>
</ul>
<h4 id="6-2、对称加密算法模型"><a href="#6-2、对称加密算法模型" class="headerlink" title="6.2、对称加密算法模型"></a>6.2、对称加密算法模型</h4><ul>
<li><pre class=" language-mermaid"><code class="language-mermaid">  sequenceDiagram
  甲方(发送方) ->> 甲方(发送方) :  1、甲方构建密钥
  甲方(发送方) ->> 乙方(接收方) :  2、甲方向乙方公布密钥
  甲方(发送方) ->> 甲方(发送方) :  3、甲方使用密钥对数据加密
  甲方(发送方) ->> 乙方(接收方) :  4、甲方向乙方发送加密数据
  乙方(接收方) ->> 乙方(接收方) :  5、使用密钥对数据解密
</code></pre>
</li>
<li><p>这里甲乙双方约定一方构建密钥，然后向另一方公布构建密钥（假设甲方来构建密钥）</p>
</li>
<li><p>如果实现双向，乙方只需要反过来实行3、4步骤，甲方实行 5步骤就可以，</p>
</li>
</ul>
<h4 id="6-3、DES-算法"><a href="#6-3、DES-算法" class="headerlink" title="6.3、DES 算法"></a>6.3、DES 算法</h4><table>
<thead>
<tr>
<th>算法</th>
<th>密钥长度</th>
<th>密钥长度默认值</th>
<th>工作模式</th>
<th>填充模式</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>DES</td>
<td>56</td>
<td>56</td>
<td>ECB、CBC、PCBC、CTR、CTS、CFB、CFB8、CFB128、OFB、OFB8、OFB128</td>
<td>NoPadding、PKCS5Padding、ISO10126Padding</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>DES</td>
<td>64</td>
<td>56</td>
<td>ECB、CBC、PCBC、CTR、CTS、CFB、CFB8、CFB128、OFB、OFB8、OFB128</td>
<td>PKCS7Padding、ISO10126d2Padding、X932Padding、ISO7816d4Padding、ZeroBytePadding</td>
<td>BouncyCastle实现</td>
</tr>
</tbody></table>
<ul>
<li><p>实现</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String  KEY_ALGORITHM <span class="token operator">=</span> <span class="token string">"DES"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String  CIPHER_ALGORITHM <span class="token operator">=</span> <span class="token string">"DES/ECB/PKCS5Padding"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> InvalidKeySpecException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Security<span class="token punctuation">.</span><span class="token function">addProvider</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">desEncryptAndDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 1、使用 DES 加密前构建密钥
     * @return byte[]
     * @throws NoSuchAlgorithmException 没有这样的算法
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">buildSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//指定算法实例化密钥生成器</span>
        KeyGenerator keyGenerator <span class="token operator">=</span> KeyGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//指定密钥长度初始化密钥生成器</span>
        keyGenerator<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//生成秘密密钥</span>
        SecretKey secretKey <span class="token operator">=</span> keyGenerator<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//返回字节数组形式的密钥，便于存储在文件或者以流的形式在网络传输</span>
        <span class="token keyword">return</span> secretKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 2、将 byte[] 字节形式的密钥值转成 SecretKey 对象使用
     * @param keys 密钥的字节数组形式
     * @return &amp;#123;@link SecretKey&amp;#125;
     * @throws InvalidKeyException 非法密钥
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeySpecException 非法密钥材料
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> SecretKey <span class="token function">byteToSecretKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys<span class="token punctuation">)</span> <span class="token keyword">throws</span> InvalidKeyException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 DES 密钥材料,将密钥转成 DES 密钥材料</span>
        DESKeySpec desKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DESKeySpec</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化秘密密钥工厂</span>
        SecretKeyFactory keyFactory <span class="token operator">=</span> SecretKeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//使用秘密密钥工厂将材料转化生成秘密密钥对象</span>
        <span class="token keyword">return</span> keyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>desKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 3、DES 加密
     * @param secretKey 密钥对象
     * @param messages 待加密数据
     * @return byte[] 加密后的密文字节数组形式
     * @throws NoSuchPaddingException 没有这样的填充方式
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeyException 非法密钥
     * @throws BadPaddingException 错误的填充方式
     * @throws IllegalBlockSizeException 非法块大小
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>SecretKey secretKey<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 Cipher 对象，用于加解密操作</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>CIPHER_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//初始化，设置为加密模式</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//执行加密操作</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 4、DES 解密
     * @param secretKey 密钥对象
     * @param cipherText 待解密数据
     * @return byte[] 解密后的明文字节数组形式
     * @throws NoSuchPaddingException 没有这样的填充方式
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeyException 非法密钥
     * @throws BadPaddingException 错误的填充方式
     * @throws IllegalBlockSizeException 非法块大小
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>SecretKey secretKey<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 Cipher 对象，用于加解密操作</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>CIPHER_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//初始化，设置为解密模式</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//执行解密操作</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">desEncryptAndDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys <span class="token operator">=</span> <span class="token function">buildSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SecretKey secretKey <span class="token operator">=</span> <span class="token function">byteToSecretKey</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String message <span class="token operator">=</span> <span class="token string">"12345678"</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">,</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"密文 Hex: "</span><span class="token operator">+</span> Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密后明文: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密后是否等于原文 : "</span><span class="token operator">+</span>message<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><p>实际应用中，<code>密文</code>通常以<code>二进制数据</code>传输或存储，而<code>密钥</code>通常会转为<code>可见字符存储</code> ,例如使用<code>Base64</code>或者<code>十六进制</code>将不可见字符转成可见字符</p>
</li>
</ul>
<h4 id="6-4、DESede-算法"><a href="#6-4、DESede-算法" class="headerlink" title="6.4、DESede 算法"></a>6.4、DESede 算法</h4><ul>
<li><p>针对 DES 算法密钥长度偏短和迭代次数偏少问题做了改良，但是处理速度较慢，密钥计算时间较长，加密效率不高问题出现</p>
</li>
<li><p>实际应用采用 3DES 方案，别名分别为 ：Triple DES 、DESede ，Java 中成为 DESede 算法</p>
</li>
<li><p>对比 DES 算法，密钥材料实现类从 DESKeySpec 转为 DESedeKeySpec</p>
</li>
<li><p>算法差别 ：从 DES 转为 DESede</p>
</li>
<li><p>密钥长度差别 ：</p>
<table>
<thead>
<tr>
<th>算法</th>
<th>密钥长度</th>
<th>密钥长度默认值</th>
<th>工作模式</th>
<th>填充模式</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>DESede</td>
<td>112、168</td>
<td>168</td>
<td>ECB、CBC、PCBC、CTR、CTS、CFB、CFB8、CFB128、OFB、OFB8、OFB128</td>
<td>NoPadding、PKCS5Padding、ISO10126Padding</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>DESede</td>
<td>128、192</td>
<td>168</td>
<td>ECB、CBC、PCBC、CTR、CTS、CFB、CFB8、CFB128、OFB、OFB8、OFB128</td>
<td>PKCS7Padding、ISO10126d2Padding、X932Padding、ISO7816d4Padding、ZeroBytePadding</td>
<td>BouncyCastle实现</td>
</tr>
</tbody></table>
</li>
<li><p>代码实现</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Provider PROVIDER <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/**
     * 密钥算法
     * Java 6 支持密钥长度为 112位、168位
     * Bouncy Castle 支持的密钥长度为 128位、192位
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String  KEY_ALGORITHM <span class="token operator">=</span> <span class="token string">"DESede"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 加密/解密算法 / 工作模式 / 填充方式
     * Java 6 支持PKCS5Padding
     * Bouncy Castle 支持PKCS7Padding
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String  CIPHER_ALGORITHM <span class="token operator">=</span> <span class="token string">"DESede/ECB/PKCS7Padding"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> NoSuchProviderException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Security<span class="token punctuation">.</span><span class="token function">addProvider</span><span class="token punctuation">(</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">desEncryptAndDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 1、使用 DES 加密前构建密钥
     * @return byte[]
     * @throws NoSuchAlgorithmException 没有这样的算法
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">buildSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//指定算法实例化密钥生成器</span>
        KeyGenerator keyGenerator <span class="token operator">=</span> KeyGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//指定密钥长度初始化密钥生成器,要大于等于168</span>
        keyGenerator<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">192</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//生成秘密密钥</span>
        SecretKey secretKey <span class="token operator">=</span> keyGenerator<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//返回字节数组形式的密钥，便于存储在文件或者以流的形式在网络传输</span>
        <span class="token keyword">return</span> secretKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 2、将 byte[] 字节形式的密钥值转成 SecretKey 对象使用
     * @param keys 密钥的字节数组形式
     * @return &amp;#123;@link SecretKey&amp;#125;
     * @throws InvalidKeyException 非法密钥
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeySpecException 非法密钥材料
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> SecretKey <span class="token function">byteToSecretKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys<span class="token punctuation">)</span> <span class="token keyword">throws</span> InvalidKeyException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 3DES 密钥材料,将密钥转成 3DES 密钥材料</span>
        DESedeKeySpec deSedeKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DESedeKeySpec</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化秘密密钥工厂</span>
        SecretKeyFactory keyFactory <span class="token operator">=</span> SecretKeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//使用秘密密钥工厂将材料转化生成秘密密钥对象</span>
        <span class="token keyword">return</span> keyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>deSedeKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 3、DES 加密
     * @param secretKey 密钥对象
     * @param messages 待加密数据
     * @return byte[] 加密后的密文字节数组形式
     * @throws NoSuchPaddingException 没有这样的填充方式
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeyException 非法密钥
     * @throws BadPaddingException 错误的填充方式
     * @throws IllegalBlockSizeException 非法块大小
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>SecretKey secretKey<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 Cipher 对象，用于加解密操作</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>CIPHER_ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//初始化，设置为加密模式</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//执行加密操作</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 4、DES 解密
     * @param secretKey 密钥对象
     * @param cipherText 待解密数据
     * @return byte[] 解密后的明文字节数组形式
     * @throws NoSuchPaddingException 没有这样的填充方式
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeyException 非法密钥
     * @throws BadPaddingException 错误的填充方式
     * @throws IllegalBlockSizeException 非法块大小
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>SecretKey secretKey<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 Cipher 对象，用于加解密操作</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>CIPHER_ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//初始化，设置为解密模式</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//执行解密操作</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">desEncryptAndDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys <span class="token operator">=</span> <span class="token function">buildSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SecretKey secretKey <span class="token operator">=</span> <span class="token function">byteToSecretKey</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String message <span class="token operator">=</span> <span class="token string">"12345678"</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">,</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"密文 Hex: "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密后明文: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密后是否等于原文 : "</span><span class="token operator">+</span>message<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="6-5、AES-算法"><a href="#6-5、AES-算法" class="headerlink" title="6.5、AES 算法"></a>6.5、AES 算法</h4></li>
<li><p>高级数据加密标准，替代 DES</p>
</li>
<li><p>密钥建立时间短、灵敏性好、内存需求低</p>
</li>
<li><p>目前常用于UMTS（Universial Mobile Telecommunications System）,通用移动通信系统，基于 ssh 部分协议也用到 AES 算法</p>
</li>
<li><table>
<thead>
<tr>
<th>算法</th>
<th>密钥长度</th>
<th>密钥长度默认值</th>
<th>工作模式</th>
<th>填充模式</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>AES</td>
<td>128、192、256</td>
<td>128</td>
<td>ECB、CBC、PCBC、CTR、CTS、CFB、CFB8、CFB128、OFB、OFB8、OFB128</td>
<td>NoPadding、PKCS5Padding、ISO10126Padding</td>
<td>Java 6 实现若使用256位密钥需要获取无政策限制权限文件</td>
</tr>
<tr>
<td>AES</td>
<td>128、192、256</td>
<td>128</td>
<td>ECB、CBC、PCBC、CTR、CTS、CFB、CFB8、CFB128、OFB、OFB8、OFB128</td>
<td>PKCS7Padding、ZeroBytePadding</td>
<td>BouncyCastle实现</td>
</tr>
</tbody></table>
</li>
<li><p>实现</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
     * 密钥算法
     * Java 6 只支持密钥长度为 56位
     * Bouncy Castle 支持的密钥长度为 64位
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String  KEY_ALGORITHM <span class="token operator">=</span> <span class="token string">"AES"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 加密/解密算法 / 工作模式 / 填充方式
     * Java 6 支持PKCS5Padding
     * Bouncy Castle 支持PKCS7Padding
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String  CIPHER_ALGORITHM <span class="token operator">=</span> <span class="token string">"AES/ECB/PKCS5Padding"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> InvalidKeySpecException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

        <span class="token function">aesEncryptAndDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 1、使用 AES 加密前构建密钥
     * @return byte[]
     * @throws NoSuchAlgorithmException 没有这样的算法
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">buildSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//指定算法实例化密钥生成器</span>
        KeyGenerator keyGenerator <span class="token operator">=</span> KeyGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//指定密钥长度初始化密钥生成器</span>
        keyGenerator<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//生成秘密密钥</span>
        SecretKey secretKey <span class="token operator">=</span> keyGenerator<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//返回字节数组形式的密钥，便于存储在文件或者以流的形式在网络传输</span>
        <span class="token keyword">return</span> secretKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 2、将 byte[] 字节形式的密钥值转成 SecretKey 对象使用
     * @param keys 密钥的字节数组形式
     * @return &amp;#123;@link SecretKey&amp;#125;
     * @throws InvalidKeyException 非法密钥
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeySpecException 非法密钥材料
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> SecretKey <span class="token function">byteToSecretKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys<span class="token punctuation">)</span> <span class="token keyword">throws</span> InvalidKeyException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//通过 SecretKeySpec 秘密密钥材料将密钥转成 秘密密钥</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 3、AES 加密
     * @param secretKey 密钥对象
     * @param messages 待加密数据
     * @return byte[] 加密后的密文字节数组形式
     * @throws NoSuchPaddingException 没有这样的填充方式
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeyException 非法密钥
     * @throws BadPaddingException 错误的填充方式
     * @throws IllegalBlockSizeException 非法块大小
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>SecretKey secretKey<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 Cipher 对象，用于加解密操作</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>CIPHER_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//初始化，设置为加密模式</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//执行加密操作</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 4、AES 解密
     * @param secretKey 密钥对象
     * @param cipherText 待解密数据
     * @return byte[] 解密后的明文字节数组形式
     * @throws NoSuchPaddingException 没有这样的填充方式
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeyException 非法密钥
     * @throws BadPaddingException 错误的填充方式
     * @throws IllegalBlockSizeException 非法块大小
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>SecretKey secretKey<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 Cipher 对象，用于加解密操作</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>CIPHER_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//初始化，设置为解密模式</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//执行解密操作</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">aesEncryptAndDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys <span class="token operator">=</span> <span class="token function">buildSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SecretKey secretKey <span class="token operator">=</span> <span class="token function">byteToSecretKey</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String message <span class="token operator">=</span> <span class="token string">"12345678"</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">,</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"密文 Hex: "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密后明文: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密后是否等于原文 : "</span><span class="token operator">+</span>message<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="6-6、IDEA-算法"><a href="#6-6、IDEA-算法" class="headerlink" title="6.6、IDEA 算法"></a>6.6、IDEA 算法</h4></li>
<li><p>国际数据加密标准</p>
</li>
<li><p>密钥长度 128 位，数据块大小为 64 位</p>
</li>
<li><p>常用于电子邮件加密算法之一（商业版权）</p>
</li>
<li><table>
<thead>
<tr>
<th>算法</th>
<th>密钥长度</th>
<th>密钥长度默认值</th>
<th>工作模式</th>
<th>填充模式</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>IDEA</td>
<td>128</td>
<td>128</td>
<td>ECB</td>
<td>PKCS5Padding、PKCS7Padding、ISO10126Padding、ZeroBytePadding</td>
<td>Bouncy Castle实现</td>
</tr>
</tbody></table>
</li>
<li><p>实现</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Provider PROVIDER <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/**
     * 密钥算法
     * Bouncy Castle 支持的密钥长度为 128位
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String  KEY_ALGORITHM <span class="token operator">=</span> <span class="token string">"IDEA"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 加密/解密算法 / 工作模式 / 填充方式
     * Bouncy Castle 支持PKCS7Padding
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String  CIPHER_ALGORITHM <span class="token operator">=</span> <span class="token string">"IDEA/ECB/ISO10126Padding"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> InvalidKeyException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

        <span class="token function">ideaEncryptAndDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 1、使用 IDEA 加密前构建密钥
     * @return byte[]
     * @throws NoSuchAlgorithmException 没有这样的算法
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">buildSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//指定算法实例化密钥生成器</span>
        KeyGenerator keyGenerator <span class="token operator">=</span> KeyGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//指定密钥长度初始化密钥生成器</span>
        keyGenerator<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//生成秘密密钥</span>
        SecretKey secretKey <span class="token operator">=</span> keyGenerator<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//返回字节数组形式的密钥，便于存储在文件或者以流的形式在网络传输</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"IDEA 128位 密钥 : "</span><span class="token operator">+</span>Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> secretKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 2、将 byte[] 字节形式的密钥值转成 SecretKey 对象使用
     * @param keys 密钥的字节数组形式
     * @return &amp;#123;@link SecretKey&amp;#125;
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> SecretKey <span class="token function">byteToSecretKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//通过 SecretKeySpec 秘密密钥材料将密钥转成 秘密密钥</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 3、IDEA 加密
     * @param secretKey 密钥对象
     * @param messages 待加密数据
     * @return byte[] 加密后的密文字节数组形式
     * @throws NoSuchPaddingException 没有这样的填充方式
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeyException 非法密钥
     * @throws BadPaddingException 错误的填充方式
     * @throws IllegalBlockSizeException 非法块大小
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>SecretKey secretKey<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 Cipher 对象，用于加解密操作</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>CIPHER_ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//初始化，设置为加密模式</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//执行加密操作</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 4、IDEA 解密
     * @param secretKey 密钥对象
     * @param cipherText 待解密数据
     * @return byte[] 解密后的明文字节数组形式
     * @throws NoSuchPaddingException 没有这样的填充方式
     * @throws NoSuchAlgorithmException 没有这样的算法
     * @throws InvalidKeyException 非法密钥
     * @throws BadPaddingException 错误的填充方式
     * @throws IllegalBlockSizeException 非法块大小
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>SecretKey secretKey<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 Cipher 对象，用于加解密操作</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>CIPHER_ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//初始化，设置为解密模式</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//执行解密操作</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ideaEncryptAndDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys <span class="token operator">=</span> <span class="token function">buildSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SecretKey secretKey <span class="token operator">=</span> <span class="token function">byteToSecretKey</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String message <span class="token operator">=</span> <span class="token string">"12345678"</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">,</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"密文 Hex: "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密后明文: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密后是否等于原文 : "</span><span class="token operator">+</span>message<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="6-7、PBE-算法（特例）"><a href="#6-7、PBE-算法（特例）" class="headerlink" title="6.7、PBE 算法（特例）"></a>6.7、PBE 算法（特例）</h4></li>
<li><p>PBE (Password Based Encryption,<code>基于口令加密</code>)</p>
</li>
<li><p>特点：口令由用户自己管理，采用随机数（通常我们叫盐）杂凑多重加密等方法保证数据的安全性</p>
</li>
<li><p>PBE 算法没有密钥的概念，而密钥是在其他对称加密算法中经过算法计算得出的，PBE 算法中则用口令代替密钥</p>
</li>
<li><p>PBE 算法并没有真正构建新的加密/解密算法，而是对我们已知的对称加密算法（如 DES 算法）做了包装，使用 PBE 算法对数据做加密/解密操作时，其实是使用了 DES 或者 AES 等其他对称加密算法做了相应的操作</p>
</li>
<li><p>既然 PBE 算法使用了对称加密算法，那就不可避免对称密钥，但口令不能代替密钥，但口令本身不能很长，常见的 PBE 算法有 : PBEWithMD5AndDES ,使用了 MD5 和 DES 算法构建了 PBE 算法</p>
</li>
<li><p>实现</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Provider PROVIDER <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String ALGORITHM <span class="token operator">=</span> <span class="token string">"PBEWITHMD5andDES"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//迭代次数</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span>  <span class="token keyword">int</span> ITERATION_COUNT <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> BadPaddingException<span class="token punctuation">,</span> InvalidAlgorithmParameterException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> InvalidKeySpecException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token function">pbeEncryptAndDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 盐的初始化
     * 盐的长度必须为 8 字节
     * @return byte[] 盐
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">initSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        SecureRandom secureRandom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> secureRandom<span class="token punctuation">.</span><span class="token function">generateSeed</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Key <span class="token function">toKey</span><span class="token punctuation">(</span>String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        PBEKeySpec pbeKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEKeySpec</span><span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SecretKeyFactory secretKeyFactory <span class="token operator">=</span> SecretKeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> secretKeyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>pbeKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> salts<span class="token punctuation">,</span><span class="token keyword">int</span> iteration<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> message<span class="token punctuation">,</span>Key key<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> InvalidAlgorithmParameterException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        PBEParameterSpec pbeParameterSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEParameterSpec</span><span class="token punctuation">(</span>salts<span class="token punctuation">,</span>iteration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span>key<span class="token punctuation">,</span>pbeParameterSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> salts<span class="token punctuation">,</span><span class="token keyword">int</span> iteration<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">,</span>Key key<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> InvalidAlgorithmParameterException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        PBEParameterSpec pbeParameterSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEParameterSpec</span><span class="token punctuation">(</span>salts<span class="token punctuation">,</span>iteration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span>key<span class="token punctuation">,</span>pbeParameterSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">pbeEncryptAndDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InvalidKeySpecException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> InvalidAlgorithmParameterException<span class="token punctuation">,</span> NoSuchPaddingException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        String message <span class="token operator">=</span> <span class="token string">"12345678"</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> salts <span class="token operator">=</span> <span class="token function">initSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String password <span class="token operator">=</span> <span class="token string">"yuanhy"</span><span class="token punctuation">;</span>
        Key key <span class="token operator">=</span> <span class="token function">toKey</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>salts<span class="token punctuation">,</span>ITERATION_COUNT<span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>salts<span class="token punctuation">,</span>ITERATION_COUNT<span class="token punctuation">,</span>cipherText<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"密文 : "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"明文 : "</span><span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


解释：
<span class="token comment" spellcheck="true">/**
     * 盐的初始化
     * 盐的长度必须为 8 字节
     * @return byte[] 盐
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">initSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        SecureRandom secureRandom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> secureRandom<span class="token punctuation">.</span><span class="token function">generateSeed</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    
<span class="token comment" spellcheck="true">// 初始化盐时必须使用随机的方式构建盐，最终要得到一个 8 字节的字节数组盐，考虑安全，建议使用            SecureRandom</span>
<span class="token comment" spellcheck="true">// PBE 的密钥材料PBEKeySpec  PBEKeySpec pbeKeySpec = new PBEKeySpec(password.toCharArray());</span>
<span class="token comment" spellcheck="true">// 实例化 PBE 的参数材料</span>
 PBEParameterSpec pbeParameterSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEParameterSpec</span><span class="token punctuation">(</span>salts<span class="token punctuation">,</span>iteration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ALGORITHM<span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span>key<span class="token punctuation">,</span>pbeParameterSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
</ul>
<h3 id="7、非对称加密算法"><a href="#7、非对称加密算法" class="headerlink" title="7、非对称加密算法"></a>7、非对称加密算法</h3><ul>
<li>非对称加密算法的速度远慢于对称加密算法，但是安全性比对称加密算法高</li>
<li>与对称加密算法不同的是，非对称加密算法的加密和解密使用的密钥不是同一个，一个公开，称为公钥，一个保密，称为私钥。因此非对称密码算法也被称为双钥或公钥加密算法</li>
<li>公钥通过非安全通道发放，私钥则由发放方保存。公钥与私钥相对应，成对出现。公钥加密的数据，只可用对应的私钥才能解密。反之，私钥加密的数据只可用对应的公钥才能解密</li>
<li>非对称加密算法源于 DH 算法（密钥交换算法）</li>
<li>分为两类：<ul>
<li>基于因子分解难题 ：RSA 算法是是最经典的非对称加密算法，既能用于数据加密也能用于数字签名</li>
<li>基于离散对数难题 ：<ul>
<li>ElGamal 算法：即可用于加解密，也可用于数字签名（DSA 演变基础）</li>
<li>ECC 算法 ：椭圆曲线加密</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="7-1、DH-算法"><a href="#7-1、DH-算法" class="headerlink" title="7.1、DH 算法"></a>7.1、DH 算法</h4><ul>
<li><p>来由</p>
<ul>
<li>对称加密算法提高了数据加密的安全性，但是密钥管理成为了最大的问题，DH 算法（密钥交换算法，密钥协商也是一种说法）用来解决如何安全传递密钥的难题</li>
</ul>
</li>
<li><p>简述</p>
<ul>
<li>目的让消息的收发双方在安全的条件下交换密钥，以备后续加密/解密使用</li>
<li>安全性基于有限域上的离散对数难题，基于这种安全性，通过 DH 算法进行密钥分配，使得消息的收发双方可以安全的交换一个秘密密钥，再通过这个秘密密钥对数据进行加密解密处理</li>
</ul>
</li>
<li><p>DH 算法模型图</p>
<pre class=" language-mermaid"><code class="language-mermaid">  sequenceDiagram
  甲方(发送方) ->> 甲方(发送方) :  1、甲方构建甲方密钥（非对称密钥）
  甲方(发送方) ->> 乙方(接收方) :  2、甲方向乙方公布甲方公钥
  乙方(接收方) ->> 乙方(接收方) :  3、乙方使用甲方公钥构建乙方密钥（非对称密钥）
  乙方(接收方) ->> 甲方(发送方) :  4、乙方向甲方公布乙方公钥
  甲方(发送方) ->> 甲方(发送方) :  5、使用甲方私钥、乙方公钥构建本地密钥（非对称密钥）
  乙方(接收方) ->> 乙方(接收方) :  5、使用乙方私钥、甲方公钥构建本地密钥（非对称密钥）
  甲方(发送方) ->> 甲方(发送方) :  6、甲方使用本地密钥对消息加密
  甲方(发送方) ->> 乙方(接收方) :  7、甲方向乙方发送加密消息
  乙方(接收方) ->> 乙方(接收方) :  8、乙方使用本地密钥对加密消息解密
</code></pre>
</li>
<li><p>实现</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> bc<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>jce<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>BouncyCastleProvider<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span>DHPrivateKey<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span>DHPublicKey<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>DHParameterSpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>SecretKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidKeySpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>PKCS8EncodedKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>X509EncodedKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DHCoder</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Provider PROVIDER <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//非对称加密密钥算法</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String ALGORITHM <span class="token operator">=</span> <span class="token string">"DH"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//本地密钥算法，即对称加密密钥算法</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String SECRET_ALGORITHM <span class="token operator">=</span> <span class="token string">"AES"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 密钥长度
     * DH 算法密钥长度默认 1024
     * 密钥长度必须是 64 的倍数，其范围在 512~1024 之间
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> KEY_SIZE <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//公钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String PUBLIC_KEY <span class="token operator">=</span> <span class="token string">"DHPublicKey"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//私钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String PRIVATE_KEY <span class="token operator">=</span> <span class="token string">"DHPrivateKey"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 初始化甲方密钥
     * @return Map 甲方密钥
     * @throws NoSuchAlgorithmException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        KeyPairGenerator keyPairGenerator <span class="token operator">=</span> KeyPairGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyPairGenerator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>KEY_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        KeyPair keyPair <span class="token operator">=</span> keyPairGenerator<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DHPublicKey publicKey <span class="token operator">=</span> <span class="token punctuation">(</span>DHPublicKey<span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DHPrivateKey privateKey <span class="token operator">=</span> <span class="token punctuation">(</span>DHPrivateKey<span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">,</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 初始化乙方密钥
     * @param keys 甲方公钥
     * @return Map 乙方密钥
     * @throws NoSuchAlgorithmException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidAlgorithmParameterException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//解析甲方公钥，转换密钥材料</span>
        X509EncodedKeySpec x509EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化密钥工厂</span>
        KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//产生公钥</span>
        PublicKey pubKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//由甲方公钥构建乙方密钥</span>
        DHParameterSpec dhParameterSpec <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DHPublicKey<span class="token punctuation">)</span>pubKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//实例化密钥生成器</span>
        KeyPairGenerator keyPairGenerator <span class="token operator">=</span> KeyPairGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//初始化密钥生成器</span>
        keyPairGenerator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>dhParameterSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//产生密钥对</span>
        KeyPair keyPair <span class="token operator">=</span> keyPairGenerator<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//乙方公钥</span>
        DHPublicKey publicKey <span class="token operator">=</span> <span class="token punctuation">(</span>DHPublicKey<span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//乙方私钥</span>
        DHPrivateKey privateKey <span class="token operator">=</span> <span class="token punctuation">(</span>DHPrivateKey<span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">,</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        SecretKey secretKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>SECRET_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 Cipher 对象，用于加解密操作</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//初始化，设置为加密模式</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//执行加密操作</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        SecretKey secretKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>SECRET_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 Cipher 对象，用于加解密操作</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//初始化，设置为加密模式</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//执行加密操作</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getSecretKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> publicKey<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> privateKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidKeyException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//初始化公钥密钥材料转换</span>
        X509EncodedKeySpec x509EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//产生公钥</span>
        PublicKey publicKey1 <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//初始化私钥密钥材料转换</span>
        PKCS8EncodedKeySpec pkcs8EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//产生私钥</span>
        PrivateKey privateKey1 <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>pkcs8EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化协商密钥对象</span>
        KeyAgreement keyAgreement <span class="token operator">=</span> KeyAgreement<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyAgreement<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>privateKey1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyAgreement<span class="token punctuation">.</span><span class="token function">doPhase</span><span class="token punctuation">(</span>publicKey1<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SecretKey secretKey <span class="token operator">=</span> keyAgreement<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>SECRET_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> secretKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> map<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> map<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//测试类</span>
<span class="token keyword">package</span> bc<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>util<span class="token punctuation">.</span>encoders<span class="token punctuation">.</span>Base64<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>BadPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>IllegalBlockSizeException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>NoSuchPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>InvalidAlgorithmParameterException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>InvalidKeyException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>NoSuchAlgorithmException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidKeySpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DHCoderTest</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//甲方公钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> publicKey1<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//甲方私钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> privateKey1<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//甲方本地密钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> secretKey1<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//乙方公钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> publicKey2<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//乙方私钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> privateKey2<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//乙方本地密钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> secretKey2<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidAlgorithmParameterException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//生成甲方密钥对</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> map1 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">initKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        publicKey1 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span>map1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        privateKey1 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span>map1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"甲方公钥 : "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>publicKey1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"甲方私钥 : "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>privateKey1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//由甲方公钥产生乙方密钥对</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> map2 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">initKey</span><span class="token punctuation">(</span>publicKey1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        publicKey2 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span>map2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        privateKey2 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span>map2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"乙方公钥 : "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>publicKey2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"乙方私钥 : "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>privateKey2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//甲方本地密钥</span>
        secretKey1 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">getSecretKey</span><span class="token punctuation">(</span>publicKey2<span class="token punctuation">,</span>privateKey1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"甲方本地密钥 : "</span><span class="token operator">+</span>Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>secretKey1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//乙方本地密钥</span>
        secretKey2 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">getSecretKey</span><span class="token punctuation">(</span>publicKey1<span class="token punctuation">,</span>privateKey2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"乙方本地密钥 : "</span><span class="token operator">+</span>Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>secretKey2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"甲方向乙方发送数据"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String input <span class="token operator">=</span> <span class="token string">"密钥交换算法"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原文 : "</span><span class="token operator">+</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用甲方本地密钥对数据加密"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText1 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>secretKey1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"加密密文 : "</span><span class="token operator">+</span>Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>cipherText1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用乙方本地密钥对数据解密"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText1 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>cipherText1<span class="token punctuation">,</span>secretKey2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密明文: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用乙方本地密钥对数据加密"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText2 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>secretKey2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"加密密文 : "</span><span class="token operator">+</span>Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>cipherText2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用甲方本地密钥对数据解密"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText2 <span class="token operator">=</span> DHCoder<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>cipherText1<span class="token punctuation">,</span>secretKey1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密明文: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//注意一个问题，默认 SUN JCE Provider,在协商密钥对象时需要加上 BC 库的 Provider</span>
<span class="token comment" spellcheck="true">//实例化协商密钥对象</span>
        KeyAgreement keyAgreement <span class="token operator">=</span> KeyAgreement<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>

否则会报错 ：
Exception in thread <span class="token string">"main"</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>NoSuchAlgorithmException<span class="token operator">:</span> Unsupported secret key algorithm<span class="token operator">:</span> AES
    at com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>DHKeyAgreement<span class="token punctuation">.</span><span class="token function">engineGenerateSecret</span><span class="token punctuation">(</span>DHKeyAgreement<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">387</span><span class="token punctuation">)</span>
    at javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>KeyAgreement<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>KeyAgreement<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">648</span><span class="token punctuation">)</span>
    at bc<span class="token punctuation">.</span>DHCoder<span class="token punctuation">.</span><span class="token function">getSecretKey</span><span class="token punctuation">(</span>DHCoder<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">130</span><span class="token punctuation">)</span>
    at bc<span class="token punctuation">.</span>DHCoderTest<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>DHCoderTest<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">44</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="7-2、RSA-算法"><a href="#7-2、RSA-算法" class="headerlink" title="7.2、RSA 算法"></a>7.2、RSA 算法</h4></li>
<li><p>遵循  ： “ 私钥加密–公钥解密 、公钥加密–私钥解密 “</p>
</li>
<li><p>基于 RSA 算法消息传递</p>
</li>
</ul>
<pre class=" language-mermaid"><code class="language-mermaid">    sequenceDiagram
    甲方(发送方) ->> 甲方(发送方) :  1、甲方构建甲方密钥（非对称密钥）
    甲方(发送方) ->> 乙方(接收方) :  2、甲方向乙方公布甲方公钥
    甲方(发送方) ->> 甲方(发送方) :  3、甲方使用私钥加密数据
    甲方(发送方) ->> 乙方(接收方) :  4、甲方向乙方发送加密后的数据
    乙方(接收方) ->> 乙方(接收方) :  5、乙方使用公钥解密数据
    乙方(接收方) ->> 乙方(接收方) :  6、乙方使用公钥加密数据
    乙方(接收方) ->> 甲方(发送方) :  7、乙方向甲方发送加密后的数据
    甲方(发送方) ->> 甲方(发送方) :  8、甲方使用私钥解密数据
</code></pre>
<ul>
<li>实际上，仅遵循 “ 私钥加密，公钥解密 “ 更安全</li>
</ul>
<table>
<thead>
<tr>
<th>算法</th>
<th>密钥长度</th>
<th>密钥长度默认值</th>
<th>工作模式</th>
<th>填充模式</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>RSA</td>
<td>512~65536位、密钥长度必须是64的倍数</td>
<td>1024</td>
<td>ECB</td>
<td>NoPadding、PKCS1Padding、OAEPWITHMD5AndMGF1Padding、OAEPWITHSHA1AndMGF1Padding、OAEPWITHSHA256AndMGF1Padding、OAEPWITHSHA384AndMGF1Padding、OAEPWITHSHA512AndMGF1Padding、</td>
<td>Java 6实现</td>
</tr>
<tr>
<td>RSA</td>
<td>512~65536位、密钥长度必须是64的倍数</td>
<td>2048</td>
<td>NONE</td>
<td>NoPadding、PKCS1Padding、OAEPWITHMD5AndMGF1Padding、OAEPWITHSHA1AndMGF1Padding、OAEPWITHSHA256AndMGF1Padding、OAEPWITHSHA384AndMGF1Padding、OAEPWITHSHA512AndMGF1Padding、</td>
<td>Bouncy Castle 实现</td>
</tr>
</tbody></table>
<ul>
<li><p>实现</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> bc<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>BadPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>Cipher<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>IllegalBlockSizeException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>NoSuchPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidKeySpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>PKCS8EncodedKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>X509EncodedKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RSACoder</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String RSA_ALGORITHM <span class="token operator">=</span> <span class="token string">"RSA"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String PUBLIC_KEY <span class="token operator">=</span> <span class="token string">"RSAPublicKey"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String PRIVATE_KEY <span class="token operator">=</span> <span class="token string">"RSAPrivateKey"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Provider provider<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 构建 RSA 密钥对
     * @param keySize 密钥长度
     * @param provider 提供者
     * @return Map 密钥对
     * @throws NoSuchAlgorithmException
     * @throws NoSuchProviderException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token keyword">int</span> keySize<span class="token punctuation">,</span>Provider provider<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> NoSuchProviderException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        RSACoder<span class="token punctuation">.</span>provider <span class="token operator">=</span> provider<span class="token punctuation">;</span>
        KeyPairGenerator keyPairGenerator <span class="token operator">=</span> KeyPairGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>RSA_ALGORITHM<span class="token punctuation">,</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyPairGenerator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>keySize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        KeyPair keyPair <span class="token operator">=</span> keyPairGenerator<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        PublicKey publicKey <span class="token operator">=</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        PrivateKey privateKey <span class="token operator">=</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">,</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyMap<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 获取公钥
     * @param keyMap 密钥对
     * @return byte[] 公钥字节数组
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> keyMap<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


    <span class="token comment" spellcheck="true">/**
     * 获取私钥
     * @param keyMap 密钥对
     * @return byte[] 私钥字节数组
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> keyMap<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//私钥使用 PKCS8EncodedKeySpec 密钥参数材料</span>
        PKCS8EncodedKeySpec pkcs8EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>RSA_ALGORITHM<span class="token punctuation">,</span>RSACoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        PrivateKey privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>pkcs8EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>RSACoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        
        PKCS8EncodedKeySpec pkcs8EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>RSA_ALGORITHM<span class="token punctuation">,</span>RSACoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        PrivateKey privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>pkcs8EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>RSACoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//公钥使用 X509EncodedKeySpec 密钥参数材料</span>
        X509EncodedKeySpec x509EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>RSA_ALGORITHM<span class="token punctuation">,</span>RSACoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        PublicKey publicKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>RSACoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        X509EncodedKeySpec x509EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>RSA_ALGORITHM<span class="token punctuation">,</span>RSACoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        PublicKey publicKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>RSACoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 测试代码</span>

<span class="token keyword">package</span> bc<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>jce<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>BouncyCastleProvider<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>util<span class="token punctuation">.</span>encoders<span class="token punctuation">.</span>Base64<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>BadPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>IllegalBlockSizeException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>NoSuchPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>InvalidKeyException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>NoSuchAlgorithmException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>NoSuchProviderException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>Provider<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidKeySpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RSACoderTest</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> Provider provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchProviderException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> NoSuchPaddingException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> keyMap <span class="token operator">=</span> RSACoder<span class="token punctuation">.</span><span class="token function">initKey</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> publicKey <span class="token operator">=</span> RSACoder<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> privateKey <span class="token operator">=</span> RSACoder<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String input <span class="token operator">=</span> <span class="token string">"RSA 算法"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原文 : "</span><span class="token operator">+</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> RSACoder<span class="token punctuation">.</span><span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RSA 公钥加密密文 : "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText <span class="token operator">=</span> RSACoder<span class="token punctuation">.</span><span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">,</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RSA 私钥解密明文 : "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原文 : "</span><span class="token operator">+</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText1 <span class="token operator">=</span> RSACoder<span class="token punctuation">.</span><span class="token function">encryptByPrivateKey</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RSA 私钥加密密文 : "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>cipherText1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText1 <span class="token operator">=</span> RSACoder<span class="token punctuation">.</span><span class="token function">decryptByPublicKey</span><span class="token punctuation">(</span>cipherText1<span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RSA 公钥解密明文 : "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//结果：</span>
原文 <span class="token operator">:</span> RSA 算法
RSA 公钥加密密文 <span class="token operator">:</span> NLdHuahaAgyY<span class="token operator">+</span>nzWt6bvXCE9VYGDbyh1YXpzvvt8pTRaVcg1TjHXOyr5<span class="token operator">/</span>31iYekP5LgZi5GUk7g89b<span class="token operator">+</span>V6ws1sXlqVUxxowXvf<span class="token operator">/</span>ah0ZMB1bZw<span class="token operator">+</span>JutMcmmyjrKmKHG3g<span class="token operator">/</span>bsn5KlMLQyUFdXSLmw364DnxDUWzhm1JPITbvAwsHEF4<span class="token operator">=</span>
RSA 私钥解密明文 <span class="token operator">:</span> RSA 算法
原文 <span class="token operator">:</span> RSA 算法
RSA 私钥加密密文 <span class="token operator">:</span> XNXMfyLAcVmMuzo<span class="token operator">/</span>tkQWywMg1jyajLMfz3hBUsfGGZ6vpCefd3SW2dlqT<span class="token operator">/</span>CFKs<span class="token operator">+</span>MUaIfCnGCPtmYD<span class="token operator">/</span>JySbk<span class="token operator">+</span>GL7rnzoEswRJHZYVdKjG3d<span class="token operator">+</span>fNKkQigvudBdDq355S3yT<span class="token operator">/</span>RXUHlABJoKy1LoHIUwU2i9<span class="token operator">+</span>uLHuBkPkVy4bt8oZj7c<span class="token operator">=</span>
RSA 公钥解密明文 <span class="token operator">:</span> RSA 算法
</code></pre>
</li>
</ul>
<h4 id="7-3、EIGamal-算法"><a href="#7-3、EIGamal-算法" class="headerlink" title="7.3、EIGamal 算法"></a>7.3、EIGamal 算法</h4><ul>
<li><p>提高了安全性，不足之处，密文成倍扩张</p>
</li>
<li><p>现在例子只有 “ 公钥加密 – 私钥解密”</p>
</li>
<li><p>EIGamal 算法模型图</p>
</li>
</ul>
<pre class=" language-bash"><code class="language-bash">
    甲方<span class="token punctuation">(</span>发送方<span class="token punctuation">)</span> --<span class="token operator">></span> 乙方<span class="token punctuation">(</span>接收方<span class="token punctuation">)</span> <span class="token keyword">:</span>  
    乙方<span class="token punctuation">(</span>接收方<span class="token punctuation">)</span> -<span class="token operator">>></span> 乙方<span class="token punctuation">(</span>接收方<span class="token punctuation">)</span> <span class="token keyword">:</span>  1、乙方构建乙方密钥对（非对称密钥）
    乙方<span class="token punctuation">(</span>接收方<span class="token punctuation">)</span> -<span class="token operator">>></span> 甲方<span class="token punctuation">(</span>发送方<span class="token punctuation">)</span> <span class="token keyword">:</span>  2、乙方向甲方公布乙方公钥
    甲方<span class="token punctuation">(</span>发送方<span class="token punctuation">)</span> -<span class="token operator">>></span> 甲方<span class="token punctuation">(</span>发送方<span class="token punctuation">)</span> <span class="token keyword">:</span>  3、甲方使用公钥对数据加密
    甲方<span class="token punctuation">(</span>发送方<span class="token punctuation">)</span> -<span class="token operator">>></span> 乙方<span class="token punctuation">(</span>接收方<span class="token punctuation">)</span> <span class="token keyword">:</span>  4、甲方向乙方发送加密后的数据
    乙方<span class="token punctuation">(</span>接收方<span class="token punctuation">)</span> -<span class="token operator">>></span> 乙方<span class="token punctuation">(</span>接收方<span class="token punctuation">)</span> <span class="token keyword">:</span>  5、乙方使用私钥解密数据
</code></pre>
<table>
<thead>
<tr>
<th>算法</th>
<th>密钥长度</th>
<th>密钥长度默认值</th>
<th>工作模式</th>
<th>填充模式</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>EIGamal</td>
<td>160~16384位、密钥长度必须是8的倍数</td>
<td>1024</td>
<td>ECB、NONE</td>
<td>NoPadding、PKCS1Padding、OAEPWITHMD5AndMGF1Padding、OAEPWITHSHA1AndMGF1Padding、OAEPWITHSHA256AndMGF1Padding、OAEPWITHSHA384AndMGF1Padding、OAEPWITHSHA512AndMGF1Padding、</td>
<td>Bouncy Castle 实现</td>
</tr>
</tbody></table>
<ul>
<li><p>实现</p>
<ul>
<li>实现方式跟 RSA 差不多，差别在于初始化密钥对</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> bc<span class="token punctuation">;</span>


<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>BadPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>Cipher<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>IllegalBlockSizeException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>NoSuchPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>DHParameterSpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidKeySpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidParameterSpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>PKCS8EncodedKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>X509EncodedKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EIgamalCoder</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String ELGAMAL_ALGORITHM <span class="token operator">=</span> <span class="token string">"ElGamal"</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String PUBLIC_KEY <span class="token operator">=</span> <span class="token string">"ElGamalPublicKey"</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String PRIVATE_KEY <span class="token operator">=</span> <span class="token string">"ElGamalPrivateKey"</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> Provider provider<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">/**
   * 构建 EIGamal 密钥对
   * @param keySize 密钥长度
   * @param provider 提供者
   * @return Map 密钥对
   * @throws NoSuchAlgorithmException
   * @throws NoSuchProviderException
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token keyword">int</span> keySize<span class="token punctuation">,</span>Provider provider<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidParameterSpecException<span class="token punctuation">,</span> InvalidAlgorithmParameterException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      EIgamalCoder<span class="token punctuation">.</span>provider <span class="token operator">=</span> provider<span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//实例化算法参数生成器</span>
      AlgorithmParameterGenerator algorithmParameterGenerator <span class="token operator">=</span> AlgorithmParameterGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ELGAMAL_ALGORITHM<span class="token punctuation">,</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//初始化算法参数生成器</span>
      algorithmParameterGenerator<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>keySize<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//生成算法参数</span>
      AlgorithmParameters algorithmParameters <span class="token operator">=</span> algorithmParameterGenerator<span class="token punctuation">.</span><span class="token function">generateParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">//构建参数材料</span>
      DHParameterSpec dhParameterSpec <span class="token operator">=</span> algorithmParameters<span class="token punctuation">.</span><span class="token function">getParameterSpec</span><span class="token punctuation">(</span>DHParameterSpec<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      KeyPairGenerator keyPairGenerator <span class="token operator">=</span> KeyPairGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ELGAMAL_ALGORITHM<span class="token punctuation">,</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
      keyPairGenerator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>dhParameterSpec<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      KeyPair keyPair <span class="token operator">=</span> keyPairGenerator<span class="token punctuation">.</span><span class="token function">genKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      PublicKey publicKey <span class="token operator">=</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      PrivateKey privateKey <span class="token operator">=</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      keyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
      keyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">,</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> keyMap<span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">/**
   * 获取公钥
   * @param keyMap 密钥对
   * @return byte[] 公钥字节数组
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> keyMap<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


  <span class="token comment" spellcheck="true">/**
   * 获取私钥
   * @param keyMap 密钥对
   * @return byte[] 私钥字节数组
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> keyMap<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      PKCS8EncodedKeySpec pkcs8EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ELGAMAL_ALGORITHM<span class="token punctuation">,</span> EIgamalCoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
      PrivateKey privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>pkcs8EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> EIgamalCoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
      cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      X509EncodedKeySpec x509EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>ELGAMAL_ALGORITHM<span class="token punctuation">,</span> EIgamalCoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
      PublicKey publicKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> EIgamalCoder<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
      cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">//测试代码</span>
<span class="token keyword">package</span> bc<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>jce<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>BouncyCastleProvider<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>util<span class="token punctuation">.</span>encoders<span class="token punctuation">.</span>Base64<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>BadPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>IllegalBlockSizeException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>NoSuchPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidKeySpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidParameterSpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EIGamalCoderTest</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> Provider provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidParameterSpecException<span class="token punctuation">,</span> InvalidAlgorithmParameterException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
      Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> keyMap <span class="token operator">=</span> EIgamalCoder<span class="token punctuation">.</span><span class="token function">initKey</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> publicKey <span class="token operator">=</span> EIgamalCoder<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> privateKey <span class="token operator">=</span> EIgamalCoder<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
      String input <span class="token operator">=</span> <span class="token string">"ElGamal 算法"</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原文 : "</span><span class="token operator">+</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> EIgamalCoder<span class="token punctuation">.</span><span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ElGamal 公钥加密密文 : "</span><span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText <span class="token operator">=</span> EIgamalCoder<span class="token punctuation">.</span><span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">,</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ElGamal 私钥解密明文 : "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//结果：</span>
原文 <span class="token operator">:</span> ElGamal 算法
ElGamal 公钥加密密文 <span class="token operator">:</span> pD80anRAHXX4GxpLl3Ha6y2vuPUzWlIfCKqqt1bM0yEyshOQVKlqAyy1VnBcsrPoHirl<span class="token operator">/</span><span class="token number">4</span><span class="token operator">+</span>tlyIi7MxJIuWFLYbiK<span class="token operator">+</span>ZbZuJ90zOLcE0uUCWqWI9IMTa<span class="token operator">+</span>fp2w6I0JyUAKbcgsl19qjInJWCk4bf3BpoCLwIEhfYedfkJc<span class="token operator">+</span>cEqQh2YPlu3B76S1o<span class="token operator">+</span>i4nEj4rIupC0oVjcZYSZ8YGkiaNRPxRLz9nklwLVYZu00BGveA<span class="token operator">/</span>g1zd4CeL6exeluvShEEBNIjVIRI<span class="token operator">+</span>QYYaiqENT<span class="token operator">+</span>egGv8iR9Vik1uI4j3CLtBmCDcHP7hdiMy1fHVXKPUUo25A1zrklPie1aKxxq6EFn7XuMBQ<span class="token operator">==</span>
ElGamal 私钥解密明文 <span class="token operator">:</span> ElGamal 算法

<span class="token comment" spellcheck="true">//注意，算法计算有点慢，ElGamal l 表示 L 的小写，不要搞错了</span>
</code></pre>
<h3 id="8、数字签名算法"><a href="#8、数字签名算法" class="headerlink" title="8、数字签名算法"></a>8、数字签名算法</h3></li>
<li><p>带密钥的消息摘要算法，而且这种密钥包含了公钥和私钥，即非对称密钥</p>
</li>
<li><p>数字签名算法是非对称加密算法和消息摘要算法的结合体</p>
</li>
<li><p>是公钥基础设施（Public Key Infrastructure PKI）以及许多网络安全机制（SSL/TLS、VPN 等）的基础</p>
</li>
<li><p>要求能够<code>验证数据完整性</code>、<code>认证数据来源</code>、<code>抗否认作用</code> ，与 OSI 参考模型中的数据完整性服务、认证（鉴别）服务和抗否认性服务相对应</p>
</li>
<li><p>用于签名的相关信息私有–&gt;对应私钥    用于验证签名的相关信息公有–&gt;对应公钥，所以遵循 私钥签名，公钥验签</p>
</li>
<li><p>签名时使用私钥和待签名数据 ，验签时使用公钥、签名、待签名数据</p>
</li>
<li><p>实际运用时，通常<code>先</code>使用消息摘要算法对原始数据做摘要处理，<code>然后</code>再使用私钥对摘要值做签名处理。验证签名时，使用公钥验证数据的摘要值</p>
</li>
<li><p>数字签名算法主要包括 ：RSA 、DSA、ECDSA，例如基于 RSA 算法密钥，结合摘要算法可形成对应的签名算法，例如结合消息摘要算法MD5，可形成 MD5WithRSA 签名算法</p>
</li>
<li><p>基于数字签名算法的消息传递模型</p>
<pre class=" language-mermaid"><code class="language-mermaid"> sequenceDiagram

  甲方(发送方) ->> 甲方(发送方) :  1、甲方构建非对称密钥对
  甲方(发送方) ->> 乙方(接收方) :  2、甲方向乙方公布公钥
  甲方(发送方) ->> 甲方(发送方) :  3、甲方使用私钥对数据签名
  甲方(发送方) ->> 乙方(接收方) :  4、甲方向乙方发送签名和数据
  乙方(接收方) ->> 乙方(接收方) :  5、乙方使用公钥、签名验证数据
</code></pre>
<pre class=" language-shell"><code class="language-shell"># 第 4 步 签名和数据（签名前的数据）一般作为一个整体发送给乙方
# 私钥仅仅签名，公钥仅仅验签
</code></pre>
</li>
</ul>
<h4 id="8-1、RSA-数字签名算法"><a href="#8-1、RSA-数字签名算法" class="headerlink" title="8.1、RSA 数字签名算法"></a>8.1、RSA 数字签名算法</h4><ul>
<li><p>实现</p>
<ul>
<li><p>经典数字签名算法</p>
</li>
<li><p>RSA 签名算法的密钥实现跟 RSA 加密算法一致，密钥产生和转换完全一致</p>
</li>
<li><p>RSA 数字签名算法分为 MD系列 和 SHA 系列</p>
<ul>
<li>MD系列 ：MD2withRSA 、MD5withRSA</li>
<li>SHA系列 ：SHA1withRSA、SHA224withRSA、SHA256withRSA、SHA384withRSA、SHA512WithRSA</li>
<li>SHA224withRSA、SHA256withRSA、SHA384withRSA、SHA512withRSA 由 BC 库支持</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>算法</th>
<th>密钥长度</th>
<th>密钥长度默认值</th>
<th>签名长度</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>MD2withRSA 、MD5withRSA、SHA1withRSA</td>
<td>512~65536位（密钥长度必须是 64 的倍数）</td>
<td>1024</td>
<td>跟密钥长度相同</td>
<td>Java 6 实现</td>
</tr>
<tr>
<td>MD2withRSA 、MD5withRSA、SHA1withRSA、SHA224withRSA、SHA256withRSA、SHA384withRSA、SHA512withRSA、RIPEMD128withRSA、RIPEMD160withRSA</td>
<td>512~65536位（密钥长度必须是 64 的倍数）</td>
<td>2048</td>
<td>跟密钥长度相同</td>
<td>Bouncy Castle实现</td>
</tr>
</tbody></table>
<ul>
<li><p>RSA 算法签名  ————  签名</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//实例化 Signature</span>
Signature signature <span class="token operator">=</span> Signature<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5withRSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token comment" spellcheck="true">//初始化 Signature(因为是使用私钥签名，所以用私钥初始化)</span>
signature<span class="token punctuation">.</span><span class="token function">initSign</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token comment" spellcheck="true">//更新，data 是待签名数据</span>
signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token comment" spellcheck="true">//签名,sign 就是签名后的签名值</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><p>RSA 算法签名  ————  验签</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//实例化 Signature</span>
Signature signature <span class="token operator">=</span> Signature<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5withRSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token comment" spellcheck="true">//初始化 Signature(因为是使用公钥验签，所以用公钥初始化)</span>
signature<span class="token punctuation">.</span><span class="token function">initVerify</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token comment" spellcheck="true">//更新，data 是待验签数据</span>
signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token comment" spellcheck="true">//验签,sign 就是签名后的签名值</span>
<span class="token keyword">boolean</span> status <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><p>RSA 签名算法默认长度 ：1024</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> bc<span class="token punctuation">;</span>
  
  
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidKeySpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>PKCS8EncodedKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>X509EncodedKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>
  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RSASignatureCoder</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  
    <span class="token comment" spellcheck="true">//密钥算法，用于构建签名验签中使用的密钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String KEY_ALGORITHM <span class="token operator">=</span> <span class="token string">"RSA"</span><span class="token punctuation">;</span>
  
    <span class="token comment" spellcheck="true">//签名算法</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String SIGNATURE_ALGORITHM <span class="token operator">=</span> <span class="token string">"MD5withRSA"</span><span class="token punctuation">;</span>
  
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String PUBLIC_KEY <span class="token operator">=</span> <span class="token string">"RSAPublicKey"</span><span class="token punctuation">;</span>
  
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String PRIVATE_KEY <span class="token operator">=</span> <span class="token string">"RSAPrivateKey"</span><span class="token punctuation">;</span>
  
    <span class="token keyword">private</span> <span class="token keyword">static</span> Provider provider<span class="token punctuation">;</span>
  
    <span class="token comment" spellcheck="true">/**
     * 构建签名验签密钥
     *
     * @param keySize  密钥长度(位)
     * @param provider 提供者
     * @return Map 密钥
     * @throws NoSuchAlgorithmException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token keyword">int</span> keySize<span class="token punctuation">,</span> Provider provider<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        RSASignatureCoder<span class="token punctuation">.</span>provider <span class="token operator">=</span> provider<span class="token punctuation">;</span>
        KeyPairGenerator keyPairGenerator <span class="token operator">=</span> KeyPairGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyPairGenerator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>keySize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        KeyPair keyPair <span class="token operator">=</span> keyPairGenerator<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">,</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">,</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyMap<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> SignatureException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//私钥转换使用 PKCS8EncodedKeySpec 密钥材料</span>
        PKCS8EncodedKeySpec pkcs8EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//初始化 密钥工厂</span>
        KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//密钥工厂使用私钥密钥材料生成私钥</span>
        PrivateKey privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>pkcs8EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Signature signature <span class="token operator">=</span> Signature<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>SIGNATURE_ALGORITHM<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initSign</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> SignatureException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//公钥转换使用 X509EncodedKeySpec 密钥材料</span>
        X509EncodedKeySpec x509EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//初始化 密钥工厂</span>
        KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//密钥工厂使用公钥密钥材料生成公钥</span>
        PublicKey publicKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Signature signature <span class="token operator">=</span> Signature<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>SIGNATURE_ALGORITHM<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initVerify</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  
<span class="token comment" spellcheck="true">//测试代码</span>
<span class="token keyword">package</span> bc<span class="token punctuation">;</span>
  
<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>jce<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>BouncyCastleProvider<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>util<span class="token punctuation">.</span>encoders<span class="token punctuation">.</span>Base64<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>util<span class="token punctuation">.</span>encoders<span class="token punctuation">.</span>Hex<span class="token punctuation">;</span>
  
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>InvalidKeyException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>NoSuchAlgorithmException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>Provider<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>SignatureException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidKeySpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>
  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RSASignatureCoderTest</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
  
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Provider PROVIDER <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> KEY_SIZE <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> SignatureException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap <span class="token operator">=</span> RSASignatureCoder<span class="token punctuation">.</span><span class="token function">initKey</span><span class="token punctuation">(</span>KEY_SIZE<span class="token punctuation">,</span> PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pubKey <span class="token operator">=</span> RSASignatureCoder<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RSA 签名算法公钥 : "</span> <span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>pubKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> priKey <span class="token operator">=</span> RSASignatureCoder<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RSA 签名算法私钥 : "</span> <span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>priKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String message <span class="token operator">=</span> <span class="token string">"RSA 数字签名算法"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"待签名数据 : "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign <span class="token operator">=</span> RSASignatureCoder<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> priKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"签名值长度 : "</span> <span class="token operator">+</span> sign<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RSA 数字签名算法签名值 : "</span> <span class="token operator">+</span> Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> status <span class="token operator">=</span> RSASignatureCoder<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sign<span class="token punctuation">,</span> pubKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RSA 数字签名算法验签 : "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>status <span class="token operator">?</span> <span class="token string">"成功"</span> <span class="token operator">:</span> <span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
  
  
<span class="token comment" spellcheck="true">//测试结果</span>
RSA 签名算法公钥 <span class="token operator">:</span> MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDxxMr9bTteETx6hwOsmQE34es2Jw<span class="token operator">+</span>QEWS46HLaRrnDAF0M<span class="token operator">/</span>oxAvvwT4<span class="token operator">/</span>Fqqo4Z<span class="token operator">/</span>ljTyVoderNlxM3nNazFrWuKoE9RtdaMz5gtUlT<span class="token operator">/</span>YFeWU8DwB3Kr0c1n5YADUYkpd9SF3HzrGhz4XwmJ4zBo3sxQT9JfRCNWTNcssbaRQchMHwIDAQAB
RSA 签名算法私钥 <span class="token operator">:</span> MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBAPHEyv1tO14RPHqHA6yZATfh6zYnD5ARZLjoctpGucMAXQz<span class="token operator">+</span>jEC<span class="token operator">+</span><span class="token operator">/</span>BPj8Wqqjhn<span class="token operator">+</span>WNPJWh16s2XEzec1rMWta4qgT1G11ozPmC1SVP9gV5ZTwPAHcqvRzWflgANRiSl31IXcfOsaHPhfCYnjMGjezFBP0l9EI1ZM1yyxtpFByEwfAgMBAAECgYAnkPKSJvOK9tHUUOQ5CuaNeVuVBoTK1GM3dP3W2wbrnX5HnMuMjQo<span class="token operator">+</span>ob87RaOb0r7sFLe6u1SWAxnvYh60UH1DZn0vznTGvXINAkok6bB1sgwna<span class="token operator">+</span>7AzagFuifNEdO6bufqfZ7H<span class="token operator">+</span>VdlKr0ojG1iPJzNA5RXu8g9SXXp5E5uRc<span class="token operator">/</span>1gQJBAP0lNy3wHMHAiR0e7C5FJ7AwDHKoNY2nT9OMkqsFy5WjbZh2tvMRHQHNR7Zo6x6xG8XCXiK34M<span class="token operator">+</span>2LNubByqizZ0CQQD0frwtqZd2yD5DrhL6DyMXHC8BGltdRVQ7ILawrZedZM8QPxm8ISbNVL<span class="token operator">+</span>351kao7IMQgSQjZ0J2JzvXnAFHLHrAkEAgXHOTYdCrTCu7F0rmF10dfub4eVxvQWZJCv1s8461EHFgPjzhEdz9b<span class="token operator">/</span>qs7Pixsb51J4XVNmB87TMK1<span class="token operator">+</span>SwpKNYQJAQHRMrYkA6gp<span class="token operator">+</span>B5<span class="token operator">+</span>TVyK4cHY4mgTVwy<span class="token operator">/</span>sta25G7iXuKGDyNeptCPVM9o8tIGjxtcSsBKTW3xJwve834m45FAdQwJAJeyMHy5eCl6E6p2p5jXAFOLk65CHC6<span class="token operator">+</span>M50swl6mlAVzR2<span class="token operator">+</span>JhxTtwHaZRU<span class="token operator">+</span>A4<span class="token operator">+</span>5kvUviGocZ1r2bekmRAsLgVfw<span class="token operator">==</span>
待签名数据 <span class="token operator">:</span> RSA 数字签名算法
签名值长度 <span class="token operator">:</span> <span class="token number">128</span>
RSA 数字签名算法签名值 <span class="token operator">:</span> cc91cc57f73d447f288b10328561b2e80101d8aeeeb716c13aa6710d064cd7c0dde63ae5f1f7eeb445581769a3a6d2d2675a5f8a7549741ba4c0fae883c928432927e60dd937a3b9f9d3a7a3c089a9132e0f5961603b7a570997d5091f2a579001373e74a5f05f69c1785aa238fd9857d39d324070ff79034bedea4cc558325c
RSA 数字签名算法验签 <span class="token operator">:</span> 成功
  
<span class="token comment" spellcheck="true">//注意 ： 这里的签名值字节长度 128 ，跟 1024位 RSA 密钥的字节长度相同，前面已经提及</span>
</code></pre>
</li>
</ul>
<h4 id="8-2、DSA-数字签名算法"><a href="#8-2、DSA-数字签名算法" class="headerlink" title="8.2、DSA 数字签名算法"></a>8.2、DSA 数字签名算法</h4><ul>
<li><p>由 RSA 数字签名算法逐一转成标准数字签名算法 DSA 算法</p>
</li>
<li><p>DSS (Digital Signature Standard) 数字签名标准</p>
</li>
<li><p>DSS 本质上是ElGamal 数字签名算法，DSS 使用的数字签名算法是 DSA 算法</p>
</li>
<li><p>与 RSA 不同的是，DSA 仅包含数字签名算法，使用 DSA 算法的数字证书无法进行加密通信，而 RSA 算法既包含数字签名算法，又包含加密/解密算法</p>
</li>
<li><p>仅包含 SHA 系列消息摘要算法, Java 6 仅支持  SHA1withDSA</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>算法</th>
<th>密钥长度</th>
<th>密钥长度默认值</th>
<th>签名长度</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>SHA1withDSA、SHA224withDSA、SHA256withDSA、SHA384withDSA、SHA512withDSA、</td>
<td>512~1024位（密钥长度必须是 64 的倍数）</td>
<td>1024</td>
<td>长度不唯一，与密钥长度无关</td>
<td>Bouncy Castle实现</td>
</tr>
</tbody></table>
<ul>
<li><p>实现</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> bc<span class="token punctuation">;</span>


<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span>DSAPrivateKey<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span>DSAPublicKey<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidKeySpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>PKCS8EncodedKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>X509EncodedKeySpec<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DSASignatureCoder</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//密钥算法，用于构建签名验签中使用的密钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String KEY_ALGORITHM <span class="token operator">=</span> <span class="token string">"DSA"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//签名算法</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String SIGNATURE_ALGORITHM <span class="token operator">=</span> <span class="token string">"SHA1withDSA"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String PUBLIC_KEY <span class="token operator">=</span> <span class="token string">"DSAPublicKey"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String PRIVATE_KEY <span class="token operator">=</span> <span class="token string">"DSAPrivateKey"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Provider provider<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 构建签名验签密钥
     *
     * @param keySize  密钥长度(位)
     * @param provider 提供者
     * @return Map 密钥
     * @throws NoSuchAlgorithmException
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token keyword">int</span> keySize<span class="token punctuation">,</span> Provider provider<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        DSASignatureCoder<span class="token punctuation">.</span>provider <span class="token operator">=</span> provider<span class="token punctuation">;</span>
        KeyPairGenerator keyPairGenerator <span class="token operator">=</span> KeyPairGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyPairGenerator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>keySize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        KeyPair keyPair <span class="token operator">=</span> keyPairGenerator<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DSAPublicKey dsaPublicKey <span class="token operator">=</span> <span class="token punctuation">(</span>DSAPublicKey<span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DSAPrivateKey dsaPrivateKey <span class="token operator">=</span> <span class="token punctuation">(</span>DSAPrivateKey<span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">,</span> dsaPublicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">,</span> dsaPrivateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyMap<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PUBLIC_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Key key <span class="token operator">=</span> <span class="token punctuation">(</span>Key<span class="token punctuation">)</span> keyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>PRIVATE_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> SignatureException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//私钥转换使用 PKCS8EncodedKeySpec 密钥材料</span>
        PKCS8EncodedKeySpec pkcs8EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//初始化 密钥工厂</span>
        KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//密钥工厂使用私钥密钥材料生成私钥</span>
        PrivateKey privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>pkcs8EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Signature signature <span class="token operator">=</span> Signature<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>SIGNATURE_ALGORITHM<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initSign</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keys<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> SignatureException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//公钥转换使用 X509EncodedKeySpec 密钥材料</span>
        X509EncodedKeySpec x509EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//初始化 密钥工厂</span>
        KeyFactory keyFactory <span class="token operator">=</span> KeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//密钥工厂使用公钥密钥材料生成公钥</span>
        PublicKey publicKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Signature signature <span class="token operator">=</span> Signature<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>SIGNATURE_ALGORITHM<span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initVerify</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//测试代码</span>
<span class="token keyword">package</span> bc<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>jce<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>BouncyCastleProvider<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>util<span class="token punctuation">.</span>encoders<span class="token punctuation">.</span>Base64<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>util<span class="token punctuation">.</span>encoders<span class="token punctuation">.</span>Hex<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>InvalidKeyException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>NoSuchAlgorithmException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>Provider<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>SignatureException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>InvalidKeySpecException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DSASignatureCoderTest</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Provider PROVIDER <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> KEY_SIZE <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeySpecException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> SignatureException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> keyMap <span class="token operator">=</span> DSASignatureCoder<span class="token punctuation">.</span><span class="token function">initKey</span><span class="token punctuation">(</span>KEY_SIZE<span class="token punctuation">,</span> PROVIDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pubKey <span class="token operator">=</span> DSASignatureCoder<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"DSA 签名算法公钥 : "</span> <span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>pubKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> priKey <span class="token operator">=</span> DSASignatureCoder<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span>keyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"DSA 签名算法私钥 : "</span> <span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>priKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String message <span class="token operator">=</span> <span class="token string">"DSA 数字签名算法"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"待签名数据 : "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign <span class="token operator">=</span> DSASignatureCoder<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> priKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"签名值长度 : "</span> <span class="token operator">+</span> sign<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"DSA 数字签名算法签名值 : "</span> <span class="token operator">+</span> Hex<span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> status <span class="token operator">=</span> DSASignatureCoder<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sign<span class="token punctuation">,</span> pubKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"DSA 数字签名算法验签 : "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>status <span class="token operator">?</span> <span class="token string">"成功"</span> <span class="token operator">:</span> <span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//测试结果</span>
DSA 签名算法公钥 <span class="token operator">:</span> MIIBuDCCASwGByqGSM44BAEwggEfAoGBAP1<span class="token operator">/</span>U4EddRIpUt9KnC7s5Of2EbdSPO9EAMMeP4C2USZpRV1AIlH7WT2NWPq<span class="token operator">/</span>xfW6MPbLm1Vs14E7gB00b<span class="token operator">/</span>JmYLdrmVClpJ<span class="token operator">+</span>f6AR7ECLCT7up1<span class="token operator">/</span>63xhv4O1fnxqimFQ8E<span class="token operator">+</span>4P208UewwI1VBNaFpEy9nXzrith1yrv8iIDGZ3RSAHHAhUAl2BQjxUjC8yykrmCouuEC<span class="token operator">/</span>BYHPUCgYEA9<span class="token operator">+</span>GghdabPd7LvKtcNrhXuXmUr7v6OuqC<span class="token operator">+</span>VdMCz0HgmdRWVeOutRZT<span class="token operator">+</span>ZxBxCBgLRJFnEj6EwoFhO3zwkyjMim4TwWeotUfI0o4KOuHiuzpnWRbqN<span class="token operator">/</span>C<span class="token operator">/</span>ohNWLx<span class="token operator">+</span>2J6ASQ7zKTxvqhRkImog9<span class="token operator">/</span>hWuWfBpKLZl6Ae1UlZAFMO<span class="token operator">/</span>7PSSoDgYUAAoGBAIqlDyWkqhJPOTV7MZOvgOtE2I7yGlk5pP<span class="token operator">+</span><span class="token number">43</span><span class="token operator">/</span>DQYYwA6w52zD<span class="token operator">/</span>jsUt4UislPRguOqsmFlx1NoE8ARr7QFcEw0vbk3vqMQgHJ1JpgISFT<span class="token operator">/</span>pYSWOPWoa1vWoTyd1NIfiXn4uL<span class="token operator">/</span>Ef2SCnJBg<span class="token operator">/</span>hggAKPc2oVNc6Dt<span class="token operator">/</span>eBbs0I8lEvwFa
DSA 签名算法私钥 <span class="token operator">:</span> MIIBSwIBADCCASwGByqGSM44BAEwggEfAoGBAP1<span class="token operator">/</span>U4EddRIpUt9KnC7s5Of2EbdSPO9EAMMeP4C2USZpRV1AIlH7WT2NWPq<span class="token operator">/</span>xfW6MPbLm1Vs14E7gB00b<span class="token operator">/</span>JmYLdrmVClpJ<span class="token operator">+</span>f6AR7ECLCT7up1<span class="token operator">/</span>63xhv4O1fnxqimFQ8E<span class="token operator">+</span>4P208UewwI1VBNaFpEy9nXzrith1yrv8iIDGZ3RSAHHAhUAl2BQjxUjC8yykrmCouuEC<span class="token operator">/</span>BYHPUCgYEA9<span class="token operator">+</span>GghdabPd7LvKtcNrhXuXmUr7v6OuqC<span class="token operator">+</span>VdMCz0HgmdRWVeOutRZT<span class="token operator">+</span>ZxBxCBgLRJFnEj6EwoFhO3zwkyjMim4TwWeotUfI0o4KOuHiuzpnWRbqN<span class="token operator">/</span>C<span class="token operator">/</span>ohNWLx<span class="token operator">+</span>2J6ASQ7zKTxvqhRkImog9<span class="token operator">/</span>hWuWfBpKLZl6Ae1UlZAFMO<span class="token operator">/</span>7PSSoEFgIUC3aukTzyuw9jjNQ77VIYic4d6IU<span class="token operator">=</span>
待签名数据 <span class="token operator">:</span> DSA 数字签名算法
签名值长度 <span class="token operator">:</span> <span class="token number">47</span>
DSA 数字签名算法签名值 <span class="token operator">:</span> 302d021436f258cdb58194b5ed117eafaefa424bef9e127b02150088aa26264c69817fbcd9514cdcff2dce254d55e9
DSA 数字签名算法验签 <span class="token operator">:</span> 成功
</code></pre>
</li>
</ul>
<h4 id="8-3、ECDSA-数字签名算法"><a href="#8-3、ECDSA-数字签名算法" class="headerlink" title="8.3、ECDSA 数字签名算法"></a>8.3、ECDSA 数字签名算法</h4><ul>
<li><p>Elliptic Curve Digital Signature Algorithm 简称 ECDSA  椭圆曲线数字签名算法</p>
</li>
<li><p>优点：速度快、强度高、签名短</p>
</li>
<li><p>应用： 微软操作系统 25 位产品密钥用到 ECDSA，产品密钥就是签名的十六进制字符串表示形式</p>
</li>
<li><p>ECDSA 数字签名算法的密钥算法 ： ECDSA,密钥产生方式跟 RSA、DSA 类似</p>
</li>
<li><p>支持的算法：NONEwithECDSA、RIPEMD160withECDSA、SHA1withECDSA、SHA224withECDSA、SHA256withECDSA、SHA384withECDSA、SHA512withECDSA</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>算法</th>
<th>密钥长度</th>
<th>密钥长度默认值</th>
<th>签名长度</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>NONEwithECDSA</td>
<td></td>
<td></td>
<td>128</td>
<td>Bouncy Castle 实现</td>
</tr>
<tr>
<td>RIPEMD160withECDSA</td>
<td></td>
<td></td>
<td>160</td>
<td>Bouncy Castle 实现</td>
</tr>
<tr>
<td>SHA1withECDSA</td>
<td></td>
<td></td>
<td>160</td>
<td>Bouncy Castle 实现</td>
</tr>
<tr>
<td>SHA224withECDSA</td>
<td></td>
<td></td>
<td>224</td>
<td>Bouncy Castle 实现</td>
</tr>
<tr>
<td>SHA256withECDSA</td>
<td></td>
<td></td>
<td>256</td>
<td>Bouncy Castle 实现</td>
</tr>
<tr>
<td>SHA384withECDSA</td>
<td></td>
<td></td>
<td>384</td>
<td>Bouncy Castle 实现</td>
</tr>
<tr>
<td>SHA512withECDSA</td>
<td></td>
<td></td>
<td>512</td>
<td>Bouncy Castle 实现</td>
</tr>
</tbody></table>
<ul>
<li><p>签名长度跟摘要算法长度相同</p>
</li>
<li><p>ECDSA 算法密钥生成仅能通过<code>算法材料</code>的方式产生</p>
</li>
<li><p>ECDSA 算法密钥生成示例</p>
</li>
</ul>
<h3 id="9、数字证书"><a href="#9、数字证书" class="headerlink" title="9、数字证书"></a>9、数字证书</h3><ul>
<li><p>数字证书集合了多种密码学算法：</p>
<ul>
<li>自身带有公钥信息，可完成相应的加密/解密操作。</li>
<li>带有数字签名，可鉴别消息来源</li>
<li>自身带有消息摘要信息，可验证证书的完整性。</li>
<li>证书本身含有用户的身份信息，因而具有认证性</li>
</ul>
</li>
<li><p>数字证书也叫电子证书，类似身份证，身份证由公安机关签发，而数字证书由数字证书颁发认证机构（Certificate Authority） CA 签发， 只有经过 CA  签发的证书在网络中才具备可认证性</p>
</li>
<li><p>国际权威数字证书颁发认证机构三巨头：</p>
<ul>
<li>VeriSign : <a target="_blank" rel="noopener" href="http://www.verisign.com/">http://www.verisign.com</a></li>
<li>GeoTrust : <a target="_blank" rel="noopener" href="http://www.geotrust.com/">http://www.geotrust.com</a></li>
<li>Thawte : <a target="_blank" rel="noopener" href="http://www.thawte.com/">http://www.thawte.com</a></li>
</ul>
</li>
<li><p>免费的 CA 签发机构：</p>
<ul>
<li>由于国际权威机构申请证书费用和维护费用昂贵，所以出现了免费的数字签发机构 CAcert</li>
<li>CAcert :  <a target="_blank" rel="noopener" href="http://www.cacert.org/">http://www.cacert.org/</a></li>
</ul>
</li>
<li><p>我国部分省份数字证书签发机构：</p>
<ul>
<li>北京市数字证书认证中心</li>
<li>安徽省数字证书认证中心</li>
<li>广东省电子商务认证中心</li>
</ul>
</li>
<li><p>数字证书签发过程实际是对申请数字证书的公钥做数字签名处理，证书的验证过程是对证书的公钥做验证签名，其中还包含证书的有效期验证</p>
</li>
<li><p>数字证书有多种文件编码格式，主要包含 <code>CER</code>编码、<code>DER</code>编码：</p>
<ul>
<li><p>CER 编码（Canonical Encoding Rules,规范编码格式），是 BER(Basic Encoding Rules,基本编码格式)的一个变种，比 BER 更严格</p>
</li>
<li><p>DER 编码（Distinguished Encoding Rules,卓越编码格式），同样是 BER 的一个变体，与 CER 不同的是，DER 使用定长模式，CER 使用变长模式</p>
</li>
<li><p>PKCS(Public-Key Cryptography Standards,公钥加密标准)，常用主要有：PKCS#7、PKCS#10、PKCS#12</p>
<ul>
<li>PKCS 常用标准</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>公钥加密标准</th>
<th>描述信息</th>
<th>文件名后缀</th>
</tr>
</thead>
<tbody><tr>
<td>PKCS#7</td>
<td>密码消息语法标准</td>
<td>.p7b、.p7c</td>
</tr>
<tr>
<td>PKCS#10</td>
<td>证书请求语法标准</td>
<td>.p10、.csr</td>
</tr>
<tr>
<td>PKCS#12</td>
<td>个人信息交换语法标准</td>
<td>.p12、.pfx</td>
</tr>
</tbody></table>
<p>PKCS#10 文件用于证书签发申请，一般证书申请请求看到 .csr后缀</p>
<p>PKCS#12 文件可作为 Java 种的密钥库或信任库直接使用</p>
<p>通常使用 Base64 编码格式作为数字证书文件存储格式</p>
<h4 id="9-1、模型分析"><a href="#9-1、模型分析" class="headerlink" title="9.1、模型分析"></a>9.1、模型分析</h4><ul>
<li>实际运用，很多数字签名属于自签名，即证书申请者为自己的证书签名（证书签发模型）</li>
</ul>
<pre class=" language-shell"><code class="language-shell">
    证书申请者 ->> 证书申请者 :  1、构建密钥对
    证书申请者 ->> 认证机构 :  2、发送算法、公钥和申请者部分信息
    认证机构 ->> 认证机构 :  3、核实用户身份
    认证机构 ->> 证书申请者 :  4、颁发数字证书
</code></pre>
<ul>
<li><p>如果认证机构是证书申请者自身，该数字证书是自签发证书</p>
</li>
<li><p>加密交互模型</p>
<ul>
<li>客户端获得服务器下发的数字证书后，即可使用数字证书进行加密交互</li>
<li>客户端请求服务器端模型</li>
</ul>
</li>
</ul>
<pre class=" language-mermaid"><code class="language-mermaid">sequenceDiagram

    客户端 --> 服务器端 :  客户端请求服务器端模型
    客户端 ->> 客户端 :  1、使用公钥加密数据
    客户端 ->> 服务器端 :  2、发送加密数据
    服务器端 ->> 服务器端 :  3、使用私钥对加密数据解密
</code></pre>
<pre class=" language-mermaid"><code class="language-mermaid">sequenceDiagram

    客户端 --> 服务器端 :  服务器端响应客户端模型
    服务器端 ->> 服务器端 :  1、使用私钥对带加密数据签名
    服务器端 ->> 服务器端 :  2、使用私钥对数据加密
    服务器端 -->> 客户端 :  3、回应加密数据、数字签名
    客户端 ->> 客户端 : 4、使用公钥对数据解密
    客户端 ->> 客户端 : 4、使用公钥和解密数据验证签名
</code></pre>
<h4 id="9-2、KeyTool-证书管理"><a href="#9-2、KeyTool-证书管理" class="headerlink" title="9.2、KeyTool 证书管理"></a>9.2、KeyTool 证书管理</h4><ul>
<li><p>数字证书管理工具 ：</p>
<ul>
<li>keytool :<ul>
<li>jdk 自带的，用于数字证书的<code>申请</code>、<code>导入</code>、<code>导出</code>和<code>撤销</code>等操作</li>
<li>keytool 与本地密钥库相关联，将私钥存于密钥库，公钥则以数字证书输出</li>
<li>keytool 位于 %JAVA_HOME%\bin 目录下</li>
<li>opnessl</li>
</ul>
</li>
</ul>
</li>
<li><p>流程：使用数字证书管理工具构建 CSR (Certificate Signing Request,数字证书签发请求)，交由 CA 机构签发，形成最终的数字证书</p>
</li>
</ul>
<h5 id="9-2-1、构建自签发数字证书"><a href="#9-2-1、构建自签发数字证书" class="headerlink" title="9.2.1、构建自签发数字证书"></a>9.2.1、构建自签发数字证书</h5><ul>
<li><p>申请数字证书之前，需要在密钥库（keystore）中以别名的方式生成本地数字证书，建立相应的加密算法、密钥、证书有效期等，同时需要提供用户的身份信息，可以为自己签发一个数字证书</p>
</li>
<li><p>以 “<a target="_blank" rel="noopener" href="http://www.zlex.org&quot;/">www.zlex.org&quot;</a> 作为别名，RSA 为密钥算法、规定密钥长度为 2048位 、指定 SHA1withRSA 作为签名算法、签发有效期 3600天</p>
<pre class=" language-shell"><code class="language-shell">C:\Program Files\Java\jdk1.8.0_181\bin>keytool -genkeypair -alias www.zlex.org -keyalg RSA -keysize 2048 -sigalg SHA1withRSA -validity 3600 -keystore zlex.keystore
输入密钥库口令:
再次输入新口令:
# 以下是签发证书时输入用户身份信息
您的名字与姓氏是什么?
  [Unknown]:  www.zlex.org
您的组织单位名称是什么?
  [Unknown]:  zlex
您的组织名称是什么?
  [Unknown]:  zlex
您所在的城市或区域名称是什么?
  [Unknown]:  BJ
您所在的省/市/自治区名称是什么?
  [Unknown]:  BJ
该单位的双字母国家/地区代码是什么?
  [Unknown]:  CN
CN=www.zlex.org, OU=zlex, O=zlex, L=BJ, ST=BJ, C=CN是否正确?
  [否]:  y

输入 <www.zlex.org> 的密钥口令
        (如果和密钥库口令相同, 按回车):

Warning:
JKS 密钥库使用专用格式。建议使用 "keytool -importkeystore -srckeystore zlex.keystore -destkeystore zlex.keystore -deststoretype pkcs12" 迁移到行业标准格式 PKCS12。


##############################################
选项:
 -genkeypair                     生成密钥对
 -alias <alias>                  要处理的条目的别名,这里是 www.zlex.org
 -keyalg <keyalg>                密钥算法名称 RSA
 -keysize <keysize>              密钥位大小 2048
 -sigalg <sigalg>                签名算法名称
 -destalias <destalias>          目标别名
 -dname <dname>                  唯一判别名
 -startdate <startdate>          证书有效期开始日期/时间
 -ext <value>                    X.509 扩展
 -validity <valDays>             有效天数,指定证书的有效期，这里是 3600天
 -keypass <arg>                  密钥口令
 -keystore <keystore>            密钥库名称，密钥库存储位置，这里名称是zlex.keystore，默认在 %JAVA_HOME%\bin 目录下
 -storepass <arg>                密钥库口令
 -storetype <storetype>          密钥库类型
 -providername <providername>    提供方名称
 -providerclass <providerclass>  提供方类名
 -providerarg <arg>              提供方参数
 -providerpath <pathlist>        提供方类路径
 -v                              详细输出
 -protected                      通过受保护的机制的口令
 
 ##############################################
 您的名字与姓氏是什么?
  [Unknown]:  www.zlex.org
 CN=www.zlex.org, OU=zlex, O=BJ, L=BJ, ST=BJ, C=CN
 这里的 CN=www.zlex.org、[Unknown]:  www.zlex.org 表示的是网络环境中的用户个体，一般指主机ip、域名等
 
 ##############################################
 也可以使用 -dname 指定用户信息，代替上面的手动输入用户身份信息
 keytool -genkeypair -alias www.zlex.org -keyalg RSA -keysize 2048 -sigalg SHA1withRSA -validity 3600 -keystore zlex.keystore -dname "CN=www.zlex.org, OU=zlex, O=BJ, L=BJ, ST=BJ, C=CN"
 
 #结果
 C:\Program Files\Java\jdk1.8.0_181\bin>keytool -genkeypair -alias www.zlex.org -keyalg RSA -keysize 2048 -sigalg SHA1withRSA -validity 3600 -keystore zlex.keystore -dname "CN=www.zlex.org, OU=zlex, O=BJ, L=BJ, ST=BJ, C=CN"
输入密钥库口令:
再次输入新口令:
输入 <www.zlex.org> 的密钥口令
        (如果和密钥库口令相同, 按回车):

Warning:
JKS 密钥库使用专用格式。建议使用 "keytool -importkeystore -srckeystore zlex.keystore -destkeystore zlex.keystore -deststoretype pkcs12" 迁移到行业标准格式 PKCS12。
</code></pre>
</li>
<li><p>导出证书</p>
<ul>
<li>将数字证书导出进行加密交互</li>
</ul>
<pre class=" language-shell"><code class="language-shell">C:\Program Files\Java\jdk1.8.0_181\bin>keytool -help
密钥和证书管理工具
    
命令:
    
 -certreq            生成证书请求
 -changealias        更改条目的别名
 -delete             删除条目
 -exportcert         导出证书
 -genkeypair         生成密钥对
 -genseckey          生成密钥
 -gencert            根据证书请求生成证书
 -importcert         导入证书或证书链
 -importpass         导入口令
 -importkeystore     从其他密钥库导入一个或所有条目
 -keypasswd          更改条目的密钥口令
 -list               列出密钥库中的条目
 -printcert          打印证书内容
 -printcertreq       打印证书请求的内容
 -printcrl           打印 CRL 文件的内容
 -storepasswd        更改密钥库的存储口令
    
使用 "keytool -command_name -help" 获取 command_name 的用法
    
C:\Program Files\Java\jdk1.8.0_181\bin>keytool -exportcert -help
keytool -exportcert [OPTION]...
    
导出证书
    
选项:
    
 -rfc                            以 RFC 样式输出 (Base64)
 -alias <alias>                  要处理的条目的别名
 -file <filename>                输出文件名
 -keystore <keystore>            密钥库名称
 -storepass <arg>                密钥库口令
 -storetype <storetype>          密钥库类型
 -providername <providername>    提供方名称
 -providerclass <providerclass>  提供方类名
 -providerarg <arg>              提供方参数
 -providerpath <pathlist>        提供方类路径
 -v                              详细输出
 -protected                      通过受保护的机制的口令
    
使用 "keytool -help" 获取所有可用命令
    
    
C:\Program Files\Java\jdk1.8.0_181\bin>keytool -exportcert -alias www.zlex.org -keystore zlex.keystore -file zlex.cer -rfc -storepass 123456
存储在文件 <zlex.cer> 中的证书
    
Warning:
JKS 密钥库使用专用格式。建议使用 "keytool -importkeystore -srckeystore zlex.keystore -destkeystore zlex.keystore -deststoretype pkcs12" 迁移到行业标准格式 PKCS12。
    
##############################################
打印数字证书信息
C:\Program Files\Java\jdk1.8.0_181\bin>keytool -printcert -v -file zlex.cer
所有者: CN=www.zlex.org, OU=zlex, O=BJ, L=BJ, ST=BJ, C=CN
发布者: CN=www.zlex.org, OU=zlex, O=BJ, L=BJ, ST=BJ, C=CN
序列号: 12179a60
有效期为 Wed Sep 16 15:16:53 CST 2020 至 Fri Jul 26 15:16:53 CST 2030
证书指纹:
         MD5:  91:40:19:72:12:A3:EB:5C:3B:A4:DC:0E:95:9A:03:C5
         SHA1: 6C:5C:62:01:36:27:FD:49:F6:A3:FE:90:A8:34:00:23:45:15:3A:80
         SHA256: 55:3E:7B:CB:89:BA:D6:14:9B:9D:2A:AC:FC:AD:5A:AC:12:DD:F5:35:4F:9E:ED:D5:BF:96:4A:D2:FF:0E:3A:56
签名算法名称: SHA1withRSA
主体公共密钥算法: 2048 位 RSA 密钥
版本: 3
    
扩展:
    
#1: ObjectId: 2.5.29.14 Criticality=false
SubjectKeyIdentifier [
KeyIdentifier [
0000: 76 2F C5 99 32 05 03 62   E0 22 62 DF C1 C7 C6 EF  v/..2..b."b.....
0010: 2C 88 8A 23                                        ,..#
]
]
# 自签发证书，X.509 第三版本类型的根证书
</code></pre>
</li>
</ul>
<h5 id="9-2-2、构建-CA-数字证书"><a href="#9-2-2、构建-CA-数字证书" class="headerlink" title="9.2.2、构建 CA 数字证书"></a>9.2.2、构建 CA 数字证书</h5><ul>
<li><p>如果要获得 CA 机构认证的数字证书，需要将数字证书签发申请（CSR）导出，经由 CA 机构认证并颁发，同时将认证后的数字证书导入本地密钥库和信任库</p>
<ul>
<li>从已存在的 keystore 文件导出数字证书签发申请</li>
</ul>
<pre class=" language-shell"><code class="language-shell">C:\Program Files\Java\jdk1.8.0_181\bin>keytool -certreq -alias www.zlex.org -keystore zlex.keystore -file zlex.csr -v
输入密钥库口令:
存储在文件 <zlex.csr> 中的认证请求
将此提交给您的 CA
    
Warning:
JKS 密钥库使用专用格式。建议使用 "keytool -importkeystore -srckeystore zlex.keystore -destkeystore zlex.keystore -deststoretype pkcs12" 迁移到行业标准格式 PKCS12。
    
C:\Program Files\Java\jdk1.8.0_181\bin>keytool -certreq -help
keytool -certreq [OPTION]...
    
生成证书请求
    
选项:
    
 -alias <alias>                  要处理的条目的别名
 -sigalg <sigalg>                签名算法名称
 -file <filename>                输出文件名
 -keypass <arg>                  密钥口令
 -keystore <keystore>            密钥库名称
 -dname <dname>                  唯一判别名
 -storepass <arg>                密钥库口令
 -storetype <storetype>          密钥库类型
 -providername <providername>    提供方名称
 -providerclass <providerclass>  提供方类名
 -providerarg <arg>              提供方参数
 -providerpath <pathlist>        提供方类路径
 -v                              详细输出
 -protected                      通过受保护的机制的口令
    
从已存在的 zlex.keystore 导出证书签发申请
使用 "keytool -help" 获取所有可用命令
    
##############################################
获得数字证书签发申请文件 zlex.csr 后，到 http://www.cacert.org/ 签发数字证书
##############################################
    
获得 CA 签发的证书后，将其导入信任库，假设 获得的 CA 证书为 cazlex.cer
keytool -importcert [OPTION]...
    
导入证书或证书链
    
选项:
    
 -noprompt                       不提示
 -trustcacerts                   信任来自 cacerts 的证书
 -protected                      通过受保护的机制的口令
 -alias <alias>                  要处理的条目的别名
 -file <filename>                输入文件名
 -keypass <arg>                  密钥口令
 -keystore <keystore>            密钥库名称
 -storepass <arg>                密钥库口令
 -storetype <storetype>          密钥库类型
 -providername <providername>    提供方名称
 -providerclass <providerclass>  提供方类名
 -providerarg <arg>              提供方参数
 -providerpath <pathlist>        提供方类路径
 -v                              详细输出
     
     
keytool -importcert -trustcacerts -alias www.zlex.org -file cazlex.cer -keystore zlex.keystore 
##############################################
导入数字证书后，查看数字证书
keytool -list -alias www.zlex.org -keystore zlex.keystore
</code></pre>
<h4 id="9-3、OpenSSL-证书管理"><a href="#9-3、OpenSSL-证书管理" class="headerlink" title="9.3、OpenSSL 证书管理"></a>9.3、OpenSSL 证书管理</h4></li>
<li><p>Open SSL （<a target="_blank" rel="noopener" href="http://www.openssl.org/%EF%BC%89%E5%BC%80%E6%94%BE%E6%BA%90%E7%A0%81%E8%BD%AF%E4%BB%B6%E5%8C%85%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BA%86">http://www.openssl.org/）开放源码软件包，实现了</a> SSL 及相关加密技术</p>
</li>
<li><p>比 Keytool 强大，可用于根证书、服务器证书和客户端证书管理，可参考：<a target="_blank" rel="noopener" href="http://www.openssl.org/docs/apps/openssl.html">http://www.openssl.org/docs/apps/openssl.html</a></p>
</li>
</ul>
<h5 id="9-3-1、构建根证书"><a href="#9-3-1、构建根证书" class="headerlink" title="9.3.1、构建根证书"></a>9.3.1、构建根证书</h5><ul>
<li><p>OpenSSL 命令</p>
<pre class=" language-shell"><code class="language-shell">    # OpenSSL 命令
    
    Standard commands
    asn1parse         ca                ciphers           cms
    crl               crl2pkcs7         dgst              dhparam
    dsa               dsaparam          ec                ecparam
    enc               engine            errstr            gendsa
    genpkey           genrsa            help              list
    nseq              ocsp              passwd            pkcs12
    pkcs7             pkcs8             pkey              pkeyparam
    pkeyutl           prime             rand              rehash
    req               rsa               rsautl            s_client
    s_server          s_time            sess_id           smime
    speed             spkac             srp               storeutl
    ts                verify            version           x509
    
    Message Digest commands (see the `dgst' command for more details)
    blake2b512        blake2s256        gost              md4
    md5               mdc2              rmd160            sha1
    sha224            sha256            sha3-224          sha3-256
    sha3-384          sha3-512          sha384            sha512
    sha512-224        sha512-256        shake128          shake256
    sm3
    
    Cipher commands (see the `enc' command for more details)
    aes-128-cbc       aes-128-ecb       aes-192-cbc       aes-192-ecb
    aes-256-cbc       aes-256-ecb       aria-128-cbc      aria-128-cfb
    aria-128-cfb1     aria-128-cfb8     aria-128-ctr      aria-128-ecb
    aria-128-ofb      aria-192-cbc      aria-192-cfb      aria-192-cfb1
    aria-192-cfb8     aria-192-ctr      aria-192-ecb      aria-192-ofb
    aria-256-cbc      aria-256-cfb      aria-256-cfb1     aria-256-cfb8
    aria-256-ctr      aria-256-ecb      aria-256-ofb      base64
    bf                bf-cbc            bf-cfb            bf-ecb
    bf-ofb            camellia-128-cbc  camellia-128-ecb  camellia-192-cbc
    camellia-192-ecb  camellia-256-cbc  camellia-256-ecb  cast
    cast-cbc          cast5-cbc         cast5-cfb         cast5-ecb
    cast5-ofb         des               des-cbc           des-cfb
    des-ecb           des-ede           des-ede-cbc       des-ede-cfb
    des-ede-ofb       des-ede3          des-ede3-cbc      des-ede3-cfb
    des-ede3-ofb      des-ofb           des3              desx
    idea              idea-cbc          idea-cfb          idea-ecb
    idea-ofb          rc2               rc2-40-cbc        rc2-64-cbc
    rc2-cbc           rc2-cfb           rc2-ecb           rc2-ofb
    rc4               rc4-40            seed              seed-cbc
    seed-cfb          seed-ecb          seed-ofb          sm4-cbc
    sm4-cfb           sm4-ctr           sm4-ecb           sm4-ofb
</code></pre>
</li>
<li><p>构建根证书之前，需要构建随机数文件</p>
<pre class=" language-shell"><code class="language-shell">OpenSSL> rand -out E:\CA\private\.rand 1000

rand 生成随机数命令
-out 输出文件路径
</code></pre>
</li>
<li><p>根证书</p>
<ul>
<li>OpenSSL 通常使用 PEM（Privacy Enbanced Mail 隐私增强邮件）编码格式保存私钥</li>
</ul>
<pre class=" language-shell"><code class="language-shell"> ################ 构建根证书私钥
 OpenSSL> genrsa -aes256 -out E:\CA\private\ca.key.pem 2048
 Generating RSA private key, 2048 bit long modulus (2 primes)
 ..............................................................+++++
 .....................+++++
 e is 65537 (0x010001)
 Enter pass phrase for E:\CA\private\ca.key.pem:
 Verifying - Enter pass phrase for E:\CA\private\ca.key.pem:
 
 # 密码是 123456
 # genrsa 产生 RSA 密钥的命令
 # -aes256 使用 AES 算法对产生的私钥加密，可选算法包括 DES、DESede、IDEA、AES等对称密钥算法
 # 2048 指生成的 RSA 密钥长度，默认 512
 
 ################ 生成根证书签发申请
 OpenSSL> req -new -key E:\CA\private\ca.key.pem -rand E:\CA\private\.rand -out E:\CA\private\ca.csr
 Enter pass phrase for E:\CA\private\ca.key.pem:
 Can't load ./.rnd into RNG
 4124:error:2406F079:random number generator:RAND_load_file:Cannot open file:crypto\rand\randfile.c:88:Filename=./.rnd
 You are about to be asked to enter information that will be incorporated
 into your certificate request.
 What you are about to enter is what is called a Distinguished Name or a DN.
 There are quite a few fields but you can leave some blank
 For some fields there will be a default value,
 If you enter '.', the field will be left blank.
 -----
 Country Name (2 letter code) [AU]:CN
 State or Province Name (full name) [Some-State]:GD
 Locality Name (eg, city) []:GZ
 Organization Name (eg, company) [Internet Widgits Pty Ltd]:KY
 Organizational Unit Name (eg, section) []:KY
 Common Name (e.g. server FQDN or YOUR name) []:www.zlex.org
 Email Address []:
 
 Please enter the following 'extra' attributes
 to be sent with your certificate request
 A challenge password []:
 An optional company name []:
 # 结果，生成 ca.csr 文件
 # req 产生证书签发申请命令
 # -new 表示新请求
 # -key 表示私钥 这里是 ca.key.pem
 # -out 表示文件输出路径
 -----BEGIN CERTIFICATE REQUEST-----
 MIICnTCCAYUCAQAwWDELMAkGA1UEBhMCQ04xCzAJBgNVBAgMAkdEMQswCQYDVQQH
 DAJHWjELMAkGA1UECgwCS1kxCzAJBgNVBAsMAktZMRUwEwYDVQQDDAx3d3cuemxl
 eC5vcmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDgGdcVL4lk+5/Q
 xOSdL/zQK2yv9WsAchm9ELShgI9X2pTLvWJJ4YvsKq6JC4R6Fuy58dgb9t7A3kIP
 8yS5LXKJ6SQILx5jHZcmWcaUsF7mCUBQ22RoQyCrr+5eMNj7cHrM66jnHJ+mY29B
 MEFSU/C9BEa4OHWjGu13+7kKTXGLYkHZzv/lzhEITuBCirGgtFrlXDbRg/PBZMwV
 h3JxWmmatlJOeMos25Mwuj5rgmnrC8lCZIfDBbJbegjo1gPD6byAinpcDBw7sH+Y
 CBgnH8I15L5C3sNouePjxxCg7naaQcZFZM3YWfN+iq4Vwf8xBekeDOKfc69XHg2r
 biojN4B3AgMBAAGgADANBgkqhkiG9w0BAQsFAAOCAQEABoRmgwGvKM8WsCAKeL/k
 yU3MPgnZcrCWUubdIohabma359NbklvJFfPXIF0Cmabz8XqmrnE8Cv26qmyM97UV
 AA8RZ8VxWDsR+mPJbfQBhJUxBIL2mHIuNHZE5LX1vdc5yQZtKzrNNLji0OG+aD4i
 6hH34xEN8pS7UII3rVuzNQHciD323HCrqSI5/clE/bBQGMg5razA/a/FYGLsnj5e
 0iWa9e3YMSsx1mbXsnNKdkODi0JIrOxB85jOiQ/Aiw9F6RI4Awm2NXhghCkDvjre
 fOD64Ziq2xopR/f4/CuXzTDdx9Orton3qr9KZ9M0n2rAGpYSCNGym5hpYpH5SLuU
 7g==
 -----END CERTIFICATE REQUEST-----
 
 ################ 签发根证书
 OpenSSL> x509 -req -days 1000 -sha1 -extensions v3_ca -signkey E:\CA\private\ca.key.pem -in E:\CA\private\ca.csr -out E:\CA\private\ca.cer
 Signature ok
 subject=C = CN, ST = GD, L = GZ, O = KY, OU = KY, CN = www.zlex.org
 Getting Private key
 Enter pass phrase for E:\CA\private\ca.key.pem:
 
 # 结果，生成 ca.cer 文件
 # x509 表示签发 X.509 格式证书的命令
 # -req 表示证书输入请求
 # -days 表示有效天数
 # -sha1 表示摘要算法
 # -extensions 表示按 OpenSSL 配置文件 v3_ca 项添加扩展
 # -signkey 表示自签名密钥
 # -in 表示输入文件，这里指证书签发申请文件
 # -out 表示输出文件，这里指签发的证书
 -----BEGIN CERTIFICATE-----
 MIIDNzCCAh8CFG9We9ZE4lOozFvvXN+LyTBVU6SEMA0GCSqGSIb3DQEBBQUAMFgx
 CzAJBgNVBAYTAkNOMQswCQYDVQQIDAJHRDELMAkGA1UEBwwCR1oxCzAJBgNVBAoM
 AktZMQswCQYDVQQLDAJLWTEVMBMGA1UEAwwMd3d3LnpsZXgub3JnMB4XDTIwMDkx
 NjA4NTc1NFoXDTIzMDYxMzA4NTc1NFowWDELMAkGA1UEBhMCQ04xCzAJBgNVBAgM
 AkdEMQswCQYDVQQHDAJHWjELMAkGA1UECgwCS1kxCzAJBgNVBAsMAktZMRUwEwYD
 VQQDDAx3d3cuemxleC5vcmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
 AQDgGdcVL4lk+5/QxOSdL/zQK2yv9WsAchm9ELShgI9X2pTLvWJJ4YvsKq6JC4R6
 Fuy58dgb9t7A3kIP8yS5LXKJ6SQILx5jHZcmWcaUsF7mCUBQ22RoQyCrr+5eMNj7
 cHrM66jnHJ+mY29BMEFSU/C9BEa4OHWjGu13+7kKTXGLYkHZzv/lzhEITuBCirGg
 tFrlXDbRg/PBZMwVh3JxWmmatlJOeMos25Mwuj5rgmnrC8lCZIfDBbJbegjo1gPD
 6byAinpcDBw7sH+YCBgnH8I15L5C3sNouePjxxCg7naaQcZFZM3YWfN+iq4Vwf8x
 BekeDOKfc69XHg2rbiojN4B3AgMBAAEwDQYJKoZIhvcNAQEFBQADggEBAFTU8MBE
 X/LFrdC/Dpe51Ll5AkXeG+/kpLmaHvK6sGTSz5+FjDzl9I53gQlVrQKh+5lAoAG2
 th4GNbq2L+Wpobc6jlOEBEka+m3nJrCcfOb5zjJHn4n8Pga0vFyNMbejNBEwkJG8
 H8z02VzIzWyKnVXPWNwQaNrbBzj7oGS8wCSN7PbyPQUCh9bJONwGLnK/xHA6g94f
 kj6QGcVNG7JdgyMTmg71VTlwBMnRZZNQxB2//XsSEPBccf7B2h7CZRPYUAglzPFs
 SHGN5/vPkBh4j2BWy2RTK99FNK1nlTrhuW8l8FwAyA+/N1ZzMj2MwGDqWt0L28Xr
 jo6RVKw8UZvnyWE=
 -----END CERTIFICATE-----
 
 ################ 证书格式转换
 OpenSSL 产生的数字证书不能在 Java 中直接使用，需要转换成 PKCS#12 编码格式
 
 OpenSSL> pkcs12 -export -cacerts -inkey E:\CA\private\ca.key.pem -in E:\CA\private\ca.cer -out  E:\CA\private\ca.p12
 Enter pass phrase for E:\CA\private\ca.key.pem:
 Enter Export Password:
 Verifying - Enter Export Password: 123456
 
 # pkcs12  PKCS#12编码格式证书命令
 # -export  导出证书
 # -cacerts 表示仅导出 CA 证书
 # -inkey 表示输入密钥
 # -in 表示输入文件，这里指根证书的 cer 格式
 # -out 表示输出文件，这里指根证书的 PKCS#7 格式
 
 
 ################ 使用 keytool 查看 ca.p12
 C:\Program Files\Java\jdk1.8.0_181\bin>keytool -list -keystore E:\CA\private\ca.p12 -storetype pkcs12 -v -storepass 123456
 密钥库类型: PKCS12
 密钥库提供方: SunJSSE
 
 您的密钥库包含 1 个条目
 
 别名: 1
 创建日期: 2020-9-16
 条目类型: PrivateKeyEntry
 证书链长度: 1
 证书[1]:
 所有者: CN=www.zlex.org, OU=KY, O=KY, L=GZ, ST=GD, C=CN
 发布者: CN=www.zlex.org, OU=KY, O=KY, L=GZ, ST=GD, C=CN
 序列号: 6f567bd644e253a8cc5bef5cdf8bc9305553a484
 有效期为 Wed Sep 16 16:57:54 CST 2020 至 Tue Jun 13 16:57:54 CST 2023
 证书指纹:
        MD5:  25:AB:E4:BE:2A:0C:D3:3D:3F:A4:DA:37:26:36:BF:34
        SHA1: 9A:F1:AE:2A:85:50:23:79:7E:8A:95:89:BD:A6:E1:65:AE:EE:AE:48
        SHA256: E0:B9:5B:23:2F:26:85:B7:D8:0E:68:AD:46:09:81:4E:0B:DF:18:6D:37:FE:B0:DC:0B:CE:6F:6B:A4:0C:1B:79
 签名算法名称: SHA1withRSA
 主体公共密钥算法: 2048 位 RSA 密钥
 版本: 1
 
 
 *******************************************
 *******************************************
</code></pre>
</li>
</ul>
<h5 id="9-3-2、使用根证书签发服务器证书"><a href="#9-3-2、使用根证书签发服务器证书" class="headerlink" title="9.3.2、使用根证书签发服务器证书"></a>9.3.2、使用根证书签发服务器证书</h5><ul>
<li><p>构建服务器证书跟根证书类似</p>
<pre class=" language-shell"><code class="language-shell">################ 构建私钥
OpenSSL> genrsa -aes256 -out E:\CA\private\server.key.pem 2048
Generating RSA private key, 2048 bit long modulus (2 primes)
........................+++++
...................................+++++
e is 65537 (0x010001)
Enter pass phrase for E:\CA\private\server.key.pem:
Verifying - Enter pass phrase for E:\CA\private\server.key.pem:


################ 生成服务器证书签发申请
OpenSSL> req -new -key E:\CA\private\server.key.pem -out E:\CA\private\server.csr
Enter pass phrase for E:\CA\private\server.key.pem:
Can't load ./.rnd into RNG
10968:error:2406F079:random number generator:RAND_load_file:Cannot open file:crypto\rand\randfile.c:88:Filename=./.rnd
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:CN
State or Province Name (full name) [Some-State]:GD
Locality Name (eg, city) []:GZ
Organization Name (eg, company) [Internet Widgits Pty Ltd]:KY
Organizational Unit Name (eg, section) []:KY
Common Name (e.g. server FQDN or YOUR name) []:www.zlex.org
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:


################ 签发服务器证书
OpenSSL> x509 -req -days 1000 -sha1 -extensions v3_req -CA E:\CA\private\ca.cer -CAkey E:\CA\private\ca.key.pem -CAserial ca.srl -CAcreateserial -in E:\CA\private\server.csr -out E:\CA\private\server.cer
Signature ok
subject=C = CN, ST = GD, L = GZ, O = KY, OU = KY, CN = www.zlex.org
Getting CA Private Key
Enter pass phrase for E:\CA\private\ca.key.pem: 123456
# x509 表示签发 X.509 格式证书的命令
# -req 表示证书输入请求
# -days 表示有效天数
# -sha1 表示摘要算法
# -extensions 表示按 OpenSSL 配置文件 v3_ca 项添加扩展
# -CA 表示 CA 证书，这里是 E:\CA\private\ca.cer（根证书）
# -CAkey 表示 CA 证书密钥，这里是E:\CA\private\ca.key.pem（根证书密钥）
# -CAserial 表示 CA 证书序列号文件
# -CAcreateserial 表示创建 CA 证书序列号
# -signkey 表示自签名密钥
# -in 表示输入文件，这里指证书签发申请文件
# -out 表示输出文件，这里指签发的证书

################ 服务器证书格式转换
OpenSSL> pkcs12 -export -clcerts -inkey E:\CA\private\server.key.pem -in E:\CA\private\server.cer -out  E:\CA\private\server.p12
Enter pass phrase for E:\CA\private\server.key.pem:
Enter Export Password:
Verifying - Enter Export Password: 123456


# pkcs12  PKCS#12编码格式证书命令
# -export  导出证书
# -clcerts 表示仅导出客户端证书
# -inkey 表示输入密钥
# -in 表示输入文件，这里指根证书的 cer 格式
# -out 表示输出文件，这里指根证书的 PKCS#7 格式

这样就可以实现单向认证
</code></pre>
<h5 id="9-3-3、使用根证书签发客户端证书"><a href="#9-3-3、使用根证书签发客户端证书" class="headerlink" title="9.3.3、使用根证书签发客户端证书"></a>9.3.3、使用根证书签发客户端证书</h5></li>
</ul>
<pre class=" language-shell"><code class="language-shell">  ################ 构建私钥
  genrsa -aes256 -out E:\CA\private\client.key.pem 2048
  
  ################ 生成客户端证书签发申请
  OpenSSL> req -new -key E:\CA\private\client.key.pem -out E:\CA\private\client.csr
  Enter pass phrase for E:\CA\private\client.key.pem:
  Can't load ./.rnd into RNG
  6704:error:2406F079:random number generator:RAND_load_file:Cannot open file:crypto\rand\randfile.c:88:Filename=./.rnd
  You are about to be asked to enter information that will be incorporated
  into your certificate request.
  What you are about to enter is what is called a Distinguished Name or a DN.
  There are quite a few fields but you can leave some blank
  For some fields there will be a default value,
  If you enter '.', the field will be left blank.
  -----
  Country Name (2 letter code) [AU]:CN
  State or Province Name (full name) [Some-State]:GD
  Locality Name (eg, city) []:GZ
  Organization Name (eg, company) [Internet Widgits Pty Ltd]:KY
  Organizational Unit Name (eg, section) []:KY
  Common Name (e.g. server FQDN or YOUR name) []:www.zlex.org
  Email Address []:
  
  Please enter the following 'extra' attributes
  to be sent with your certificate request
  A challenge password []:
  An optional company name []:
  
  ################ 签发客户端证书
</code></pre>
<h4 id="9-4、证书的使用"><a href="#9-4、证书的使用" class="headerlink" title="9.4、证书的使用"></a>9.4、证书的使用</h4><ul>
<li><p>Java 6 提供了完善的数字证书管理实现，我们几乎无需关注相关的具体算法，仅通过操作密钥库和数字证书就可完成相应的加密/解密和签名/验签操作。密钥库管理私钥，数字证书管理公钥，私钥和密钥分属消息传递两方，进行消息加密传递</p>
</li>
<li><p>依据上面，密钥库看作私钥的相关操作入口，数字证书看作公钥的相关操作入口</p>
</li>
<li><p>以 Keytool 产生的密钥库和数字证书为例</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 加载密钥库</span>
<span class="token keyword">package</span> bc<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileInputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>KeyStore<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>KeyStoreException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>NoSuchAlgorithmException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>cert<span class="token punctuation">.</span>CertificateException<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CertificateCoder</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 加载密钥库，需要密钥库文件路径和密钥库密码
     * @param keyStorePath 密钥库文件路径
     * @param password 密钥库密码
     * @return &amp;#123;@link KeyStore&amp;#125; 密钥库
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> KeyStore <span class="token function">getKeyStore</span><span class="token punctuation">(</span>String keyStorePath<span class="token punctuation">,</span>String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> KeyStoreException<span class="token punctuation">,</span> IOException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> NoSuchAlgorithmException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 keystore 对象， KeyStore.getDefaultType() 是可以改变的</span>
        KeyStore keyStore <span class="token operator">=</span> KeyStore<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KeyStore<span class="token punctuation">.</span><span class="token function">getDefaultType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        FileInputStream fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyStore<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>fileInputStream<span class="token punctuation">,</span>password<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyStore<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//加载密钥库后，就能通过相关的方法获得私钥，也可以获得数字证书</span>

<span class="token comment" spellcheck="true">//由密钥库获得私钥</span>
<span class="token keyword">public</span> PrivateKey <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>String alias<span class="token punctuation">,</span>String keyStorePath<span class="token punctuation">,</span>String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> UnrecoverableKeyException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> KeyStoreException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//获得密钥库</span>
        KeyStore keyStore <span class="token operator">=</span> <span class="token function">getKeyStore</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment" spellcheck="true">//获得私钥</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>PrivateKey<span class="token punctuation">)</span> keyStore<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span>alias<span class="token punctuation">,</span>password<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//获得私钥后就可以执行私钥加密、私钥解密等操作</span>

<span class="token comment" spellcheck="true">//如果需要从密钥库中获得签名算法，只能通过由密钥库中获取的数字证书并强转为 X509Certificate 实例，再通过 getSigAlgName() 获得对应的签名算法</span>

<span class="token keyword">public</span> Signature <span class="token function">getSignature</span><span class="token punctuation">(</span>String alias<span class="token punctuation">,</span> String keyStorePath<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> UnrecoverableKeyException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> KeyStoreException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//获得密钥库</span>
        KeyStore keyStore <span class="token operator">=</span> <span class="token function">getKeyStore</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//获得证书</span>
        X509Certificate x509Certificate <span class="token operator">=</span> <span class="token punctuation">(</span>X509Certificate<span class="token punctuation">)</span> keyStore<span class="token punctuation">.</span><span class="token function">getCertificate</span><span class="token punctuation">(</span>alias<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//构建签名，由签名证书指定签名算法</span>
        <span class="token keyword">return</span> Signature<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>x509Certificate<span class="token punctuation">.</span><span class="token function">getSigAlgName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//通过以上操作，就可以使用私钥进行签名操作了</span>

<span class="token comment" spellcheck="true">//相比于密钥库操作，数字证书的操作更为简单，只需要给出数字证书的路径并加载它就可以</span>

<span class="token comment" spellcheck="true">//加载数字证书</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> Certificate <span class="token function">getCertificate</span><span class="token punctuation">(</span>String certificatePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> CertificateException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化证书工厂，证书类型 : X.509</span>
        CertificateFactory certificateFactory <span class="token operator">=</span> CertificateFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"X.509"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        FileInputStream fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> certificateFactory<span class="token punctuation">.</span><span class="token function">generateCertificate</span><span class="token punctuation">(</span>fileInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Java 6 仅支持 X.509 类型证书，通过证书可以获得公钥</span>
<span class="token comment" spellcheck="true">//由数字证书获得公钥</span>
<span class="token keyword">public</span> PublicKey <span class="token function">getPublicKey</span><span class="token punctuation">(</span>String certificatePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> CertificateException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//获得证书</span>
        Certificate certificate <span class="token operator">=</span> <span class="token function">getCertificate</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//从证书获得公钥</span>
        <span class="token keyword">return</span> certificate<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//获得公钥后就可以执行公钥加密、公钥解密操作</span>

<span class="token comment" spellcheck="true">//如果使用数字证书进行验证签名操作时，需要将获得的证书对象强转为 X509Certificate 实例</span>


<span class="token comment" spellcheck="true">//完整代码</span>
<span class="token keyword">package</span> bc<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>BadPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>Cipher<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>IllegalBlockSizeException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>NoSuchPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileInputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>cert<span class="token punctuation">.</span>Certificate<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>cert<span class="token punctuation">.</span>CertificateException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>cert<span class="token punctuation">.</span>CertificateFactory<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>cert<span class="token punctuation">.</span>X509Certificate<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CertificateCoder</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String CERT_TYPE <span class="token operator">=</span> <span class="token string">"X.509"</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 加载密钥库，需要密钥库文件路径和密钥库密码
     *
     * @param keyStorePath 密钥库文件路径
     * @param password     密钥库密码
     * @return &amp;#123;@link KeyStore&amp;#125; 密钥库
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> KeyStore <span class="token function">getKeyStore</span><span class="token punctuation">(</span>String keyStorePath<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> KeyStoreException<span class="token punctuation">,</span> IOException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> UnrecoverableKeyException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化 keystore 对象， KeyStore.getDefaultType() 是可以改变的</span>
        KeyStore keyStore <span class="token operator">=</span> KeyStore<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KeyStore<span class="token punctuation">.</span><span class="token function">getDefaultType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        FileInputStream fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyStore<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>fileInputStream<span class="token punctuation">,</span> password<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyStore<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> PrivateKey <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>String alias<span class="token punctuation">,</span> String keyStorePath<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> UnrecoverableKeyException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> KeyStoreException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//获得密钥库</span>
        KeyStore keyStore <span class="token operator">=</span> <span class="token function">getKeyStore</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//获得私钥</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>PrivateKey<span class="token punctuation">)</span> keyStore<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span>alias<span class="token punctuation">,</span> password<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Signature <span class="token function">getSignature</span><span class="token punctuation">(</span>String alias<span class="token punctuation">,</span> String keyStorePath<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> UnrecoverableKeyException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> KeyStoreException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//获得密钥库</span>
        KeyStore keyStore <span class="token operator">=</span> <span class="token function">getKeyStore</span><span class="token punctuation">(</span>keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//获得证书</span>
        X509Certificate x509Certificate <span class="token operator">=</span> <span class="token punctuation">(</span>X509Certificate<span class="token punctuation">)</span> keyStore<span class="token punctuation">.</span><span class="token function">getCertificate</span><span class="token punctuation">(</span>alias<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//构建签名，由签名证书指定签名算法</span>
        <span class="token keyword">return</span> Signature<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>x509Certificate<span class="token punctuation">.</span><span class="token function">getSigAlgName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Certificate <span class="token function">getCertificate</span><span class="token punctuation">(</span>String certificatePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> CertificateException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//实例化证书工厂，证书类型 : X.509</span>
        CertificateFactory certificateFactory <span class="token operator">=</span> CertificateFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>CERT_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span>

        FileInputStream fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Certificate certificate <span class="token operator">=</span> certificateFactory<span class="token punctuation">.</span><span class="token function">generateCertificate</span><span class="token punctuation">(</span>fileInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> certificate<span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> PublicKey <span class="token function">getPublicKey</span><span class="token punctuation">(</span>String certificatePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> CertificateException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//获得证书</span>
        Certificate certificate <span class="token operator">=</span> <span class="token function">getCertificate</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//从证书获得公钥</span>
        <span class="token keyword">return</span> certificate<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> Signature <span class="token function">getVerifySignature</span><span class="token punctuation">(</span>String certificatePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> CertificateException<span class="token punctuation">,</span> IOException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//获得证书</span>
        X509Certificate x509Certificate <span class="token operator">=</span> <span class="token punctuation">(</span>X509Certificate<span class="token punctuation">)</span> <span class="token function">getCertificate</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//由证书构建签名</span>
        Signature signature <span class="token operator">=</span> Signature<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>x509Certificate<span class="token punctuation">.</span><span class="token function">getSigAlgName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//由证书初始化签名，实际上使用了证书中的公钥</span>
        signature<span class="token punctuation">.</span><span class="token function">initVerify</span><span class="token punctuation">(</span>x509Certificate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span> String alias<span class="token punctuation">,</span> String keyStorePath<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> UnrecoverableKeyException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> KeyStoreException<span class="token punctuation">,</span> IOException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        PrivateKey privateKey <span class="token operator">=</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>alias<span class="token punctuation">,</span> keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">,</span> String alias<span class="token punctuation">,</span> String keyStorePath<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> UnrecoverableKeyException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> KeyStoreException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

        PrivateKey privateKey <span class="token operator">=</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>alias<span class="token punctuation">,</span> keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span> String certificatePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        PublicKey publicKey <span class="token operator">=</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText<span class="token punctuation">,</span> String certificatePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        PublicKey publicKey <span class="token operator">=</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Cipher cipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>Cipher<span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span> String alias<span class="token punctuation">,</span> String keyStorePath<span class="token punctuation">,</span> String password<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> SignatureException<span class="token punctuation">,</span> UnrecoverableKeyException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> KeyStoreException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>

        PrivateKey privateKey <span class="token operator">=</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>alias<span class="token punctuation">,</span> keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Signature signature <span class="token operator">=</span> <span class="token function">getSignature</span><span class="token punctuation">(</span>alias<span class="token punctuation">,</span> keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initSign</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign<span class="token punctuation">,</span> String certificatePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchAlgorithmException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> SignatureException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        PublicKey publicKey <span class="token operator">=</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Signature signature <span class="token operator">=</span> <span class="token function">getVerifySignature</span><span class="token punctuation">(</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initVerify</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>


<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//测试代码</span>
<span class="token keyword">package</span> bc<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>util<span class="token punctuation">.</span>encoders<span class="token punctuation">.</span>Base64<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>BadPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>IllegalBlockSizeException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>NoSuchPaddingException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>cert<span class="token punctuation">.</span>CertificateException<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//这里的证书需要去 9.2 使用 keytool 生成</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CertificateCoderTest</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> String password <span class="token operator">=</span> <span class="token string">"123456"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> String alias <span class="token operator">=</span> <span class="token string">"localhost"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> String certificatePath <span class="token operator">=</span> <span class="token string">"E:\\CA\\keytool\\localhost.cer"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> String keyStorePath <span class="token operator">=</span> <span class="token string">"E:\\CA\\keytool\\localhost.keystore"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> UnrecoverableKeyException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> KeyStoreException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> SignatureException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//test2();</span>
        <span class="token comment" spellcheck="true">//test1();</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//公钥加密---私钥解密</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> NoSuchPaddingException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> IllegalBlockSizeException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> IOException<span class="token punctuation">,</span> UnrecoverableKeyException<span class="token punctuation">,</span> KeyStoreException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" 公钥加密 ---- 私钥解密 "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String message <span class="token operator">=</span> <span class="token string">"数字证书"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原文 : "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> CertificateCoder<span class="token punctuation">.</span><span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"密文 : "</span> <span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText <span class="token operator">=</span> CertificateCoder<span class="token punctuation">.</span><span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"明文 : "</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException<span class="token punctuation">,</span> CertificateException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> UnrecoverableKeyException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> NoSuchPaddingException<span class="token punctuation">,</span> BadPaddingException<span class="token punctuation">,</span> KeyStoreException<span class="token punctuation">,</span> IllegalBlockSizeException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" 私钥加密 ---- 公钥解密 "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String message <span class="token operator">=</span> <span class="token string">"数字证书"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原文 : "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> CertificateCoder<span class="token punctuation">.</span><span class="token function">encryptByPrivateKey</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"密文 : "</span> <span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plainText <span class="token operator">=</span> CertificateCoder<span class="token punctuation">.</span><span class="token function">decryptByPublicKey</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">,</span> certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"明文 : "</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plainText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> CertificateException<span class="token punctuation">,</span> UnrecoverableKeyException<span class="token punctuation">,</span> NoSuchAlgorithmException<span class="token punctuation">,</span> KeyStoreException<span class="token punctuation">,</span> SignatureException<span class="token punctuation">,</span> InvalidKeyException<span class="token punctuation">,</span> IOException <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" 私钥签名 ---- 公钥验签 "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String message <span class="token operator">=</span> <span class="token string">"签名"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"原文 : "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cipherText <span class="token operator">=</span> CertificateCoder<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> keyStorePath<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"签名 : "</span> <span class="token operator">+</span> Base64<span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>cipherText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> status <span class="token operator">=</span> CertificateCoder<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span>cipherText<span class="token punctuation">,</span>certificatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"验签结果 : "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>status <span class="token operator">?</span> <span class="token string">"成功"</span> <span class="token operator">:</span> <span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//测试结果</span>
私钥签名 <span class="token operator">--</span><span class="token operator">--</span> 公钥验签 
原文 <span class="token operator">:</span> 签名
签名 <span class="token operator">:</span> Iykf1<span class="token operator">/</span>nAZjFkL<span class="token operator">/</span>aEwQD7nLc<span class="token operator">/</span>PLxIuuhC0ice0YdnG1IhUeY7NHd0iCZMsIkwsRS3NIbNoQjuj5iMmDWwpr9N9ILJzAHdExtwztDJL9jhz5AFVKEcVQ<span class="token operator">/</span>Tk2ZZHC5XaE7pMKgwGG<span class="token operator">+</span>v<span class="token operator">/</span>yDo87fk8VZKoY2ALkPw<span class="token operator">/</span>dE2KjOm5WLAXOpDLvHlmtq<span class="token operator">/</span>jkX19zCOkmR2Asihc<span class="token operator">+</span>3KUG39Sv4raW<span class="token operator">+</span>r0ogu61GQkK3GCzMODnDfZZUUokf7SAz3j<span class="token operator">/</span>YHf7Fw8rvymJyxCAJeLcw3c7RIJ6zCzpNeH9FZF0XpzBP9v37g13u9xPClOVlS4fLG3zbf3fWvNe5ir7aE2ImwmeaaqEHxUg<span class="token operator">==</span>
验签结果 <span class="token operator">:</span> 成功
</code></pre>
<h3 id="10、安全协议"><a href="#10、安全协议" class="headerlink" title="10、安全协议"></a>10、安全协议</h3></li>
<li><p>HTTPS 基于 SSL/TLS 的 HTTP 协议</p>
</li>
<li><p>HTTPS协议和 SSL 协议分属 TCP/IP 参考模型的应用层和传输层</p>
</li>
<li><p>Web 常用的安全访问协议</p>
</li>
<li><p>SSL/TLS协议包含两个协议，SSL（Secure Socket Layer 安全套接字层）、TLS（Transport Layer Security 传输层安全）</p>
</li>
<li><p>目前 SSL 版本： SSL1.0、SSL2.0、SSL3.0</p>
</li>
<li><p>通常所说的SSL/TLS 指的是 SSL3.0 或 TLS1.0 的网络协议</p>
</li>
</ul>
<h4 id="10-1、模型分析"><a href="#10-1、模型分析" class="headerlink" title="10.1、模型分析"></a>10.1、模型分析</h4><ul>
<li><p>协商算法 ： 服务器和客户端进行握手协议的第一阶段主要是协商算法</p>
<pre class=" language-mermaid"><code class="language-mermaid">sequenceDiagram

  客户端 --> 客户端 :  1、产生随机数 RNC
  客户端 ->> 服务器端 :  2、发送 SSL/TLS 信息、算法信息、随机数
  服务器端 ->> 服务器端 :  3、产生随机数 RNC
  服务器端 -->> 客户端 :  4、回复 SSL/TLS 信息、算法信息、随机数、其他信息
</code></pre>
<pre class=" language-shell"><code class="language-shell"># 1、客户端产生随机数RNC（Random Number Client）,这个随机数为后面构建密钥做准备
# 2、
</code></pre>
</li>
<li><p>后期更新单向认证和双向认证</p>
</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">袁胡悦</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://yuan-hy.github.io/2022/09/13/crypto/">https://yuan-hy.github.io/2022/09/13/crypto/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">袁胡悦</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/crypto/">
                                    <span class="chip bg-color">crypto</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/09/14/redis-strings/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="Redis strings 类型教程">
                        
                        <span class="card-title">Redis strings 类型教程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-09-14
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Redis/" class="post-category">
                                    Redis
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Redis/">
                        <span class="chip bg-color">Redis</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/09/13/redis/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="Redis">
                        
                        <span class="card-title">Redis</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-09-13
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Redis/" class="post-category">
                                    Redis
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Redis/">
                        <span class="chip bg-color">Redis</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1,h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1,h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        font-size: 15px;
        color: #42b983;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="kugou"
                   type="song"
                   id="4YENl40zDV2"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='false'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022</span>
            
            <a href="/about" target="_blank">袁胡悦</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">40.4k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2022";
                        var startMonth = "1";
                        var startDate = "11";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/yuan-hy" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1070403684@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1070403684" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1070403684" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>





    <a href="https://www.zhihu.com/signin?next=%2F" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/signin?next=%2F" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
